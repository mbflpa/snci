
<!--- <cfdump var="#form#"> <cfdump var="#session#"> --->
 <!---  <cfdump var="#url#">  --->

<cfquery name="qAcesso" datasource="#dsn_inspecao#">
	select Usu_GrupoAcesso, Usu_Matricula, Usu_Email from usuarios where Usu_login = (<cfqueryparam cfsqltype="cf_sql_varchar" value="#cgi.REMOTE_USER#">)
</cfquery>

<cfquery name="qUsuario" datasource="#dsn_inspecao#">
  SELECT DISTINCT Usu_Apelido, Usu_Lotacao, Usu_LotacaoNome, Usu_DR, Usu_Email
  FROM Usuarios
  WHERE Usu_Login = '#CGI.REMOTE_USER#'
  GROUP BY Usu_DR, Usu_Apelido, Usu_Lotacao, Usu_LotacaoNome, Usu_Email
</cfquery>


<cfquery name="rsvlrdec" datasource="#dsn_inspecao#">
   SELECT Itn_ValorDeclarado FROM Itens_Verificacao WHERE Itn_NumGrupo=#ngrup# AND Itn_NumItem=#nitem#
 </cfquery>
<cfquery name="rsSEINCI" datasource="#dsn_inspecao#">
 SELECT Pos_NCISEI FROM ParecerUnidade WHERE Pos_Unidade='#unid#' AND Pos_Inspecao='#ninsp#' AND Pos_NCISEI Is Not Null ORDER BY Pos_NCISEI DESC
</cfquery>

<cfif Trim(qAcesso.Usu_GrupoAcesso) eq 'GESTORES' or Trim(qAcesso.Usu_GrupoAcesso) eq 'DESENVOLVEDORES' or Trim(qAcesso.Usu_GrupoAcesso) eq 'INSPETORES'>

<!--- <cftry>  --->

  <cfif isDefined("Form.acao") And (Form.acao is 'Incluir_Causa' Or Form.acao is 'Anexar' Or Form.acao is 'Excluir_Anexo' Or Form.acao is 'Excluir_Causa')>
  <cfif isDefined("Form.abertura")><cfset Session.E01.abertura = Form.abertura><cfelse><cfset Session.E01.abertura = 'Não'></cfif>
  <cfif isDefined("Form.processo")><cfset Session.E01.processo = Form.proc_se & Form.proc_num & Form.proc_ano><cfelse><cfset Session.E01.processo = ''></cfif>
  <cfif isDefined("Form.causaprovavel")><cfset Session.E01.causaprovavel = Form.causaprovavel><cfelse><cfset Session.E01.causaprovavel = ''></cfif>
  <cfif isDefined("Form.cbarea")><cfset Session.E01.cbarea = Form.cbarea><cfelse><cfset Session.E01.cbarea = ''></cfif>
  <cfif isDefined("Form.cbdata")><cfset Session.E01.cbdata = Form.cbdata><cfelse><cfset Session.E01.cbdata = ''></cfif>
  <cfif isDefined("Form.cbunid")><cfset Session.E01.cbunid = Form.cbunid><cfelse><cfset Session.E01.cbunid = ''></cfif>
  <cfif isDefined("Form.frmresp")><cfset Session.E01.frmresp = Form.frmresp><cfelse><cfset Session.E01.frmresp = ''></cfif>
  <cfif isDefined("Form.cborgao")><cfset Session.E01.cborgao = Form.cborgao><cfelse><cfset Session.E01.cborgao = ''></cfif>
  <cfif isDefined("Form.cktipo")><cfset Session.E01.cktipo = Form.cktipo><cfelse><cfset Session.E01.cktipo = ''></cfif>
  <cfif isDefined("Form.dtfinal")><cfset Session.E01.dtfinal = Form.dtfinal><cfelse><cfset Session.E01.dtfinal = ''></cfif>
  <cfif isDefined("Form.dtinicio")><cfset Session.E01.dtinicio = Form.dtinicio><cfelse><cfset Session.E01.dtinicio = ''></cfif>
  <cfif isDefined("Form.hreop")><cfset Session.E01.hreop = Form.hreop><cfelse><cfset Session.E01.hreop = ''></cfif>
  <cfif isDefined("Form.hunidade")><cfset Session.E01.hunidade = Form.hunidade><cfelse><cfset Session.E01.hunidade = ''></cfif>
  <cfif isDefined("Form.h_obs")><cfset Session.E01.h_obs = Form.h_obs><cfelse><cfset Session.E01.h_obs = ''></cfif>
  <cfif isDefined("Form.melhoria")><cfset Session.E01.melhoria = Form.melhoria><cfelse><cfset Session.E01.melhoria = ''></cfif>
  <cfif isDefined("Form.ngrup")><cfset Session.E01.ngrup = Form.ngrup><cfelse><cfset Session.E01.ngrup = ''></cfif>
  <cfif isDefined("Form.ninsp")><cfset Session.E01.ninsp = Form.ninsp><cfelse><cfset Session.E01.ninsp = ''></cfif>
  <cfif isDefined("Form.nitem")><cfset Session.E01.nitem = Form.nitem><cfelse><cfset Session.E01.nitem = ''></cfif>
  <cfif isDefined("Form.frmmotivo")><cfset Session.E01.frmmotivo = Form.frmmotivo><cfelse><cfset Session.E01.frmmotivo = ''></cfif>
  <cfif isDefined("Form.cbData")><cfset Session.E01.cbData = Form.cbData><cfelse><cfset Session.E01.cbData = ''></cfif>
  <cfif isDefined("Form.observacao")><cfset Session.E01.observacao = Form.observacao><cfelse><cfset Session.E01.observacao = ''></cfif>
  <cfif isDefined("Form.recomendacao")><cfset Session.E01.recomendacao = Form.recomendacao><cfelse><cfset Session.E01.recomendacao = ''></cfif>
  <cfif isDefined("Form.reop")><cfset Session.E01.reop = Form.reop><cfelse><cfset Session.E01.reop = ''></cfif>
  <cfif isDefined("Form.unid")><cfset Session.E01.unid = Form.unid><cfelse><cfset Session.E01.unid = ''></cfif>
  <cfif isDefined("Form.modalidade")><cfset Session.E01.modalidade = Form.modalidade><cfelse><cfset Session.E01.modalidade = ''></cfif>
  <cfif isDefined("Form.valor")><cfset Session.E01.valor = Form.valor><cfelse><cfset Session.E01.valor = ''></cfif>
  <cfif isDefined("Form.SE")><cfset Session.E01.SE = Form.SE><cfelse><cfset Session.E01.SE = ''></cfif>
  <cfif isDefined("Form.VLRecuperado")><cfset Session.E01.VLRecuperado = Form.VLRecuperado><cfelse><cfset Session.E01.VLRecuperado = ''></cfif>
  <cfif isDefined("Form.cbareaCS")><cfset Session.E01.cbareaCS = Form.cbareaCS><cfelse><cfset Session.E01.cbareaCS = ''></cfif>


<!--- Incluir Causa Provavel --->

<cfif Form.acao is "Incluir_Causa" and Form.causaprovavel neq "">
  	<cfquery datasource="#dsn_inspecao#" name="qVerificaRegistroParecer">
	SELECT PCP_Unidade FROM ParecerCausaProvavel
    WHERE (((PCP_Unidade)='#unid#') AND ((PCP_Inspecao)='#ninsp#') AND ((PCP_NumGrupo)=#ngrup#) AND ((PCP_NumItem)=#nitem#) AND ((PCP_CodCausaProvavel)=#Form.causaprovavel#))
	</cfquery>

    <cfif qVerificaRegistroParecer.RecordCount eq 0>
		  <cfquery datasource="#dsn_inspecao#" name="qVerificaCausa">
				 INSERT INTO ParecerCausaProvavel(PCP_Unidade, PCP_Inspecao, PCP_NumGrupo, PCP_NumItem, PCP_CodCausaProvavel)
				 VALUES ('#unid#', '#ninsp#', #ngrup#, #nitem#, #Form.causaprovavel#)
		  </cfquery>
    </cfif>
</cfif>

  <!--- Anexar arquivo --->

<cfif Form.acao is 'Anexar'>
	<cftry>

		<cffile action="upload" filefield="arquivo" destination="#diretorio_anexos#" nameconflict="overwrite" accept="application/pdf">

		<cfset data = DateFormat(now(),'DD-MM-YYYY') & '-' & TimeFormat(Now(),'HH') & 'h' & TimeFormat(Now(),'MM') & 'min' & TimeFormat(Now(),'SS') & 's'>

		<cfset origem = cffile.serverdirectory & '\' & cffile.serverfile>
		<!--- O arquivo anexo recebe nome indicando Numero da inspeção, Número da unidade, Número do grupo e número do item ao qual está vinculado --->

		<cfset destino = cffile.serverdirectory & '\' & Form.ninsp & '_' & data & '_' & right(CGI.REMOTE_USER,8) & '_' & Form.ngrup & '_' & Form.nitem & '.pdf'>


		<cfif FileExists(origem)>

			<cffile action="rename" source="#origem#" destination="#destino#">

			<cfquery datasource="#dsn_inspecao#" name="qVerificaAnexo">
				SELECT Ane_Codigo FROM Anexos
				WHERE Ane_Caminho = <cfqueryparam cfsqltype="cf_sql_varchar" value="#destino#">
			</cfquery>


			<cfif qVerificaAnexo.recordCount eq 0>

				<cfquery datasource="#dsn_inspecao#" name="qVerifica">
				 INSERT INTO Anexos(Ane_NumInspecao, Ane_Unidade, Ane_NumGrupo, Ane_NumItem, Ane_Caminho)
				 VALUES ('#Form.ninsp#','#Form.unid#',#Form.ngrup#,#Form.nitem#,'#destino#')
				</cfquery>

		    </cfif>
         </cfif>

	   <cfcatch type="any">
			<cfset mensagem = 'Ocorreu um erro ao efetuar esta operação, o campo Arquivo está vazio, Selecione um arquivo no formato PDF'>
			<script>
				alert('<cfoutput>#mensagem#</cfoutput>');
				history.back();
			</script>
			<cfif isDefined("Session.E01")>
			  <cfset StructClear(Session.E01)>
			</cfif>
			<!--- <cfdump var="#cfcatch#">
			<cfabort> --->
	   </cfcatch>
	 </cftry>
  </cfif>

  <!--- Excluir anexo --->
	 <cfif Form.acao is 'Excluir_Anexo'>
	  <!--- Verificar se anexo existe --->

		 <cfquery datasource="#dsn_inspecao#" name="qAnexos">
			SELECT Ane_Codigo, Ane_Caminho FROM Anexos
			WHERE Ane_Codigo = '#vCodigo#'
		 </cfquery>

		 <cfif qAnexos.recordCount Neq 0>

			<!--- Exluindo arquivo do diretório de Anexos --->
			<cfif FileExists(qAnexos.Ane_Caminho)>
				<cffile action="delete" file="#qAnexos.Ane_Caminho#">
			</cfif>

			<!--- Excluindo anexo do banco de dados --->

			<cfquery datasource="#dsn_inspecao#">
			  DELETE FROM Anexos
			  WHERE  Ane_Codigo = '#vCodigo#'
			</cfquery>

		 </cfif>
	</cfif>
	
  <!--- Excluir Causa --->
	<cfif Form.acao is 'Excluir_Causa'>
	  <!--- Verificar se Causa existe --->
		  <cfquery name="qCausaExcluir" datasource="#dsn_inspecao#">
			SELECT PCP_Unidade, PCP_Inspecao, PCP_NumGrupo, PCP_NumItem, PCP_CodCausaProvavel
			FROM ParecerCausaProvavel
			WHERE PCP_Unidade='#unid#' AND PCP_Inspecao='#ninsp#' AND PCP_NumGrupo=#ngrup# AND PCP_NumItem=#nitem# AND PCP_CodCausaProvavel=#vCausaProvavel#
		  </cfquery>

	<!--- <cfdump var="#qCausaExcluir#"> --->

		 <cfif qCausaExcluir.recordCount Neq 0>

			<!--- Excluindo Causa do banco de dados --->

			<cfquery datasource="#dsn_inspecao#">
			  DELETE FROM ParecerCausaProvavel
			  WHERE PCP_Unidade='#unid#' AND PCP_Inspecao='#ninsp#' AND PCP_NumGrupo=#ngrup# AND PCP_NumItem=#nitem# AND PCP_CodCausaProvavel=#vCausaProvavel#
			</cfquery>
		 </cfif>
	</cfif>
</cfif>

 <cfquery name="qUnidade" datasource="#dsn_inspecao#">
		SELECT Und_descricao FROM Unidades
		WHERE UND_codigo='#unid#'
 </cfquery>
<cfquery datasource="#dsn_inspecao#" name="qVerificaPonto">
	SELECT Itn_ValorDeclarado FROM Itens_Verificacao
	WHERE Itn_NumGrupo = #ngrup#  AND Itn_NumItem = #nitem# AND Itn_ValorDeclarado = 'S'
</cfquery>
<!--- <cfdump var="#qUnidade#"> --->
<!--- Controle de salva para o form acao = 'Salvar' --->
 <cfif IsDefined("FORM.acao") And Form.acao is "Salvar">

	  <cfquery datasource="#dsn_inspecao#">
		UPDATE Resultado_Inspecao SET
	  <cfif IsDefined("FORM.Melhoria") AND FORM.Melhoria NEQ "">
		RIP_Comentario=
		  <cfset aux_mel = CHR(13) & Form.Melhoria>
		  <!--- <As linhas abaixo servem para substituir o uso de aspas simples e duplas, a fim de evitar erros em instruções SQL --->
		  <cfset aux_mel = Replace(aux_mel,'"','','All')>
		  <cfset aux_mel = Replace(aux_mel,"'","","All")>
		  <cfset aux_mel = Replace(aux_mel,'*','','All')>
		<!---  <cfset aux_mel = Replace(aux_mel,'&','','All')>
		   <cfset aux_mel = Replace(aux_mel,'%','','All')> --->
		  '#aux_mel#'
	   </cfif>
	   <cfif IsDefined("FORM.recomendacao") AND FORM.recomendacao NEQ "">
		 , RIP_Recomendacoes=
		  <cfset aux_recom = CHR(13) & FORM.recomendacao>
		  <!--- As linhas abaixo servem para substituir o uso de aspas simples e duplas, a fim de evitar erros em instruções SQL --->
		  <cfset aux_recom = Replace(aux_recom,'"','','All')>
		  <cfset aux_recom = Replace(aux_recom,"'","","All")>
		  <cfset aux_recom = Replace(aux_recom,'*','','All')>
		<!---  <cfset aux_recom = Replace(aux_recom,'&','','All')>
		   <cfset aux_recom = Replace(aux_recom,'%','','All')> --->
		  '#aux_recom#'
		</cfif>
		<cfif FORM.frmReinccb eq "S">
			, RIP_ReincInspecao = '#FORM.frmreincInsp#'
			, RIP_ReincGrupo = #FORM.frmreincGrup#
			, RIP_ReincItem = #FORM.frmreincItem#
		<cfelse>
			, RIP_ReincInspecao = ''
			, RIP_ReincGrupo = ''
			, RIP_ReincItem = ''
		</cfif> 
		  , RIP_UserName = '#CGI.REMOTE_USER#'
		  , RIP_DtUltAtu = CONVERT(char, GETDATE(), 102)
		  WHERE RIP_Unidade='#FORM.unid#' AND RIP_NumInspecao='#FORM.ninsp#' AND RIP_NumGrupo=#FORM.ngrup# AND RIP_NumItem=#FORM.nitem#
	  </cfquery>

	<cfif isDefined("Session.E01")>
	  <cfset StructClear(Session.E01)>
	</cfif>

</cfif>

<!--- <cfdump var="#url#"> <cfabort> --->

<!--- Nova consulta para verificar respostas das unidades --->
<cfquery name="qSituacaoResp" datasource="#dsn_inspecao#">
  SELECT Pos_Situacao_Resp, Pos_NomeArea, Pos_Area
  FROM ParecerUnidade
  WHERE Pos_Unidade='#unid#' AND Pos_Inspecao='#ninsp#' AND Pos_NumGrupo=#ngrup# AND Pos_NumItem=#nitem#
</cfquery>

<cfquery name="qResponsavel" datasource="#dsn_inspecao#">
    SELECT INP_Responsavel
    FROM Inspecao
    WHERE (INP_NumInspecao = '#ninsp#')
</cfquery>
<!--- Visualização de anexos --->
<cfquery name="qAnexos" datasource="#dsn_inspecao#">
  SELECT Ane_NumInspecao, Ane_Unidade, Ane_NumGrupo, Ane_NumItem, Ane_Codigo, Ane_Caminho
  FROM Anexos
  WHERE  Ane_NumInspecao = '#ninsp#' AND Ane_Unidade = '#unid#' AND Ane_NumGrupo = #ngrup# AND Ane_NumItem = #nitem#
</cfquery>

<cfquery name="qCausa" datasource="#dsn_inspecao#">
  SELECT Cpr_Codigo, Cpr_Descricao FROM CausaProvavel WHERE Cpr_Codigo not in (select PCP_CodCausaProvavel from ParecerCausaProvavel
  WHERE PCP_Unidade='#unid#' AND PCP_Inspecao='#ninsp#' AND PCP_NumGrupo=#ngrup# AND PCP_NumItem=#nitem#)
  ORDER BY Cpr_Descricao
</cfquery>

<cfset CurrentPage=GetFileFromPath(GetTemplatePath())>

<cfif isDefined("Form.Ninsp") and form.Ninsp neq "">

	<cfparam name="URL.Unid" default="#Form.Unid#">
	<cfparam name="URL.Ninsp" default="#Form.Ninsp#">
	<cfparam name="URL.Ngrup" default="#Form.Ngrup#">
	<cfparam name="URL.Nitem" default="#Form.Nitem#">
	<cfparam name="URL.Desc" default="">
	<cfparam name="URL.DGrup" default="">
	<cfparam name="URL.numpag" default="0">
	<cfparam name="URL.dtFinal" default="#form.dtfinal#">
	<cfparam name="URL.DtInic" default="#form.dtinicio#">
	<cfparam name="URL.dtFim" default="#form.dtfinal#">
	<cfparam name="URL.Reop" default="#Form.Reop#">
	<cfparam name="URL.ckTipo" default="#form.ckTipo#">
	<cfparam name="URL.SE" default="#Form.SE#">
	<cfparam name="URL.selstatus" default="#form.selstatus#">
	<cfparam name="URL.statusse" default="#Form.statusse#">
	<cfparam name="URL.sfrmPosArea" default="#Form.sfrmPosArea#">
	<cfparam name="URL.sfrmPosNomeArea" default="#form.sfrmPosNomeArea#">
	<cfparam name="URL.sfrmTipoUnidade" default="#Form.sfrmTipoUnidade#">

<cfelse>

	<cfparam name="URL.Unid" default="0">
	<cfparam name="URL.Ninsp" default="">
	<cfparam name="URL.Ngrup" default="">
	<cfparam name="URL.Nitem" default="">
	<cfparam name="URL.Desc" default="">
	<cfparam name="URL.DGrup" default="0">
	<cfparam name="URL.numpag" default="0">
	<cfparam name="URL.dtFinal" default="0">
	<cfparam name="URL.DtInic" default="0">
	<cfparam name="URL.dtFim" default="0">
	<cfparam name="URL.Reop" default="">
	<cfparam name="URL.ckTipo" default="">
	<cfparam name="URL.SE" default="">
	<cfparam name="URL.selstatus" default="">
	<cfparam name="URL.statusse" default="">
	<cfparam name="URL.sfrmPosArea" default="">
	<cfparam name="URL.sfrmPosNomeArea" default="">
	<cfparam name="URL.sfrmTipoUnidade" default="">

</cfif>

<cfquery name="rsMod" datasource="#dsn_inspecao#">
  SELECT Und_Descricao, Und_CodReop, Und_Codigo, Und_CodDiretoria, Und_Email, Dir_Descricao, Dir_Codigo, Dir_Sigla, Dir_Sto, Dir_Email
  FROM Unidades INNER JOIN Diretoria ON Und_CodDiretoria = Dir_Codigo
  WHERE Und_Codigo = '#URL.Unid#'
</cfquery>
 <cfset strIDGestor = #url.unid#>
 <cfset strNomeGestor = #rsMod.Und_Descricao#>  
<!--- <cfif qSituacaoResp.recordCount Neq 0>
	<cfparam name="FORM.frmResp" default="#qSituacaoResp.Pos_Situacao_Resp#">
<cfelse>
	<cfparam name="Form.frmResp" default="N">
</cfif> --->

<!--- <cfdump var="#qSituacaoResp#"> --->
 
 <!--- Item da AC respondido por CDD quando Centralizada --->
 <cfif sfrmTipoUnidade eq 4>
  <!--- É uma AC  => verificar se é centralizada --->
	  <cfquery name="rsCentral" datasource="#dsn_inspecao#">
		SELECT Cen_CDD FROM Centraliza WHERE Cen_AC = '#url.unid#'
	  </cfquery>
	  <cfif rsCentral.recordcount gt 0>
			<cfquery name="rsMod" datasource="#dsn_inspecao#">
				SELECT Und_Descricao, Und_CodReop, Und_Codigo, Und_CodDiretoria, Und_Email, Dir_Descricao, Dir_Codigo, Dir_Sigla, Dir_Sto, Dir_Email
				FROM Unidades INNER JOIN Diretoria ON Und_CodDiretoria = Dir_Codigo
				WHERE Und_Codigo = '#rsCentral.Cen_CDD#'
			</cfquery>
			<!--- Atualizar variaveis com os dados do CDD --->
			<cfset strIDGestor = #rsCentral.Cen_CDD#>
			<cfset strNomeGestor = #rsMod.Und_Descricao#> 
	  </cfif>
     
</cfif>

<cfif IsDefined("FORM.MM_UpdateRecord") AND FORM.MM_UpdateRecord EQ "form1" And IsDefined("FORM.acao") And Form.acao is "Salvar2">
       <!--- data do dia default --->
	   <cfset dtnovoprazo = CreateDate(year(now()),month(now()),day(now()))>

       <!--- Gestor concedeu um prazo a mais  --->
	   <!--- <cfif IsDefined("FORM.frmnovoprazo") AND FORM.frmnovoprazo EQ "S"> --->
	      <cfset dtnovoprazo = dateformat(form.cbData,"dd/mm/yyyy")>
 	 <!---   </cfif> --->

		<!--- inicio loop --->
	   <cfset nCont = 1>
	   <cfloop condition="nCont lt 2">
		<cfif nCont eq 1>
			<!--- verificar se Feriado Nacional --->
			<cfquery name="rsFeriado" datasource="#dsn_inspecao#">
				 SELECT Fer_Data FROM FeriadoNacional where Fer_Data = #dtnovoprazo#
			</cfquery>
			<cfif rsFeriado.recordcount gt 0>
			   <cfset dtnovoprazo = DateAdd( "d", 1, dtnovoprazo)>
			   <cfset nCont = 1>
			<cfelse>
			   <cfset nCont = 2>
			</cfif>
		</cfif>
		<!--- Verifica se final de semana  --->
		 <cfset vDiaSem = DayOfWeek(dtnovoprazo)>
		 <cfswitch expression="#vDiaSem#">
		  <cfcase value="1">
			 <!--- domingo --->
			 <cfset dtnovoprazo = DateAdd("d", 1, dtnovoprazo)>
			 <cfset nCont = 1>
		  </cfcase>
		  <cfcase value="7">
			  <!--- sábado --->
			  <cfset dtnovoprazo = DateAdd("d", 2, dtnovoprazo)>
			  <cfset nCont = 1>
		  </cfcase>
		  <cfdefaultcase>
			  <cfset nCont = 2>
		  </cfdefaultcase>
		</cfswitch>
	   </cfloop>
	  <!--- ===================== --->

 <cfquery datasource="#dsn_inspecao#">
  UPDATE ParecerUnidade SET
  <cfif IsDefined("FORM.frmResp") AND FORM.frmResp NEQ "N">
    Pos_Situacao_Resp=#FORM.frmResp#
  </cfif>
  <cfset IDArea = #form.unid#>
  <cfswitch expression="#Form.frmResp#">

	<cfcase value=2>
	  , Pos_Situacao = 'PU'
	  , Pos_Area = '#strIDGestor#'
	  , Pos_NomeArea = '#strNomeGestor#'
	  , Pos_DtPrev_Solucao = #createodbcdate(createdate(year(dtnovoprazo),month(dtnovoprazo),day(dtnovoprazo)))#
	  <cfset Gestor = '#rsMod.Und_Descricao#'>
	  <cfset situacao = 'PENDENTE DE UNIDADE'>
	  <cfset IDArea = #strIDGestor#>
	</cfcase>
	<cfcase value=3>
	  , Pos_Situacao = 'SO'
	  , Pos_Area = '#strIDGestor#'
	  , Pos_NomeArea = '#strNomeGestor#'
	  , Pos_DtPrev_Solucao = #createodbcdate(createdate(year(dtnovoprazo),month(dtnovoprazo),day(dtnovoprazo)))#
	  <cfset Gestor = '#qSituacaoResp.Pos_NomeArea#'>
	  <cfset situacao = 'SOLUCIONADO'>
	  <cfset IDArea = #strIDGestor#>
	</cfcase>
	<cfcase value=4>
	  <cfquery name="rsReop" datasource="#dsn_inspecao#">
		  SELECT Rep_Codigo, Rep_Nome FROM Reops INNER JOIN Unidades ON Rep_Codigo = Und_CodReop WHERE Und_Codigo='#strIDGestor#'
      </cfquery>
	   , Pos_Situacao = 'PO'
	   , Pos_Area = '#rsReop.Rep_Codigo#'
	   , Pos_Nomearea = '#rsReop.Rep_Nome#'
	   , Pos_DtPrev_Solucao = #createodbcdate(createdate(year(dtnovoprazo),month(dtnovoprazo),day(dtnovoprazo)))#
	   <cfset Gestor = '#rsReop.Rep_Nome#'>
	   <cfset situacao = 'PENDENTE DE ORGAO SUBORDINADOR'>
	   <cfset IDArea = #rsReop.Rep_Codigo#>
	 </cfcase>
	<cfcase value=5>
	  <cfquery name="qArea2" datasource="#dsn_inspecao#">
		SELECT Ars_Sigla
		FROM Areas
		WHERE Ars_Codigo = '#Form.cbArea#'
	  </cfquery>
	   , Pos_Situacao = 'PA'
	   , Pos_Area = '#Form.cbArea#'
	   , Pos_Nomearea = '#qArea2.Ars_Sigla#'
	   , Pos_DtPrev_Solucao = #createodbcdate(createdate(year(dtnovoprazo),month(dtnovoprazo),day(dtnovoprazo)))#
	   <cfset Gestor = '#qArea2.Ars_Sigla#'>
	   <cfset situacao = 'PENDENTE DE AREA'>
	   <cfset IDArea = #Form.cbArea#>
	</cfcase>
	<cfcase value=8>
	  , Pos_Situacao = 'SE'
	  , Pos_Area = '#rsMod.Dir_Sto#'
	  , Pos_NomeArea = '#rsMod.Dir_Descricao#'
	  , Pos_DtPrev_Solucao = #createodbcdate(createdate(year(dtnovoprazo),month(dtnovoprazo),day(dtnovoprazo)))#
	  <cfset Gestor = '#rsMod.Dir_Descricao#'>
	  <cfset situacao = 'PENDENTE SUPERINTENDENCIA ESTADUAL'>
	  <cfset IDArea = '#rsMod.Dir_Sto#'>
	</cfcase>
	<cfcase value=9>
	   <cfquery name="qArea2" datasource="#dsn_inspecao#">
		SELECT Ars_Sigla
		FROM Areas
		WHERE Ars_Codigo = '#Form.cbAreaCS#'
	   </cfquery>
	  , Pos_Nomearea = '#qArea2.Ars_Sigla#'
	  , Pos_Situacao = 'CS'
	  , Pos_Area = '#Form.cbAreaCS#'
	  , Pos_DtPrev_Solucao = #createodbcdate(createdate(year(dtnovoprazo),month(dtnovoprazo),day(dtnovoprazo)))#
	   <cfset Gestor = '#qArea2.Ars_Sigla#'>
	   <cfset situacao = 'CORPORATIVO CS'>
	   <cfset IDArea = #Form.cbAreaCS#>
	</cfcase>
	<cfcase value=10>
	  <cfquery name="qArea2" datasource="#dsn_inspecao#">
		SELECT Ars_Sigla
		FROM Areas
		WHERE Ars_Codigo = '#Form.cbArea#'
	  </cfquery>
      , Pos_Situacao = 'PS'
	  , Pos_Area = '#Form.cbArea#'
      , Pos_Nomearea = '#qArea2.Ars_Sigla#'
	  , Pos_DtPrev_Solucao = #createodbcdate(createdate(year(dtnovoprazo),month(dtnovoprazo),day(dtnovoprazo)))#
      <cfset Gestor = '#qArea2.Ars_Sigla#'>
	  <cfset situacao = 'PONTO SUSPENSO'>
	  <cfset IDArea = #Form.cbArea#>
	</cfcase>
	<cfcase value=12>
	  , Pos_Situacao = 'PI'
	  , Pos_Area = '#strIDGestor#'
	  , Pos_NomeArea = '#strNomeGestor#'
	  , Pos_DtPrev_Solucao = #createodbcdate(createdate(year(dtnovoprazo),month(dtnovoprazo),day(dtnovoprazo)))#
	  <cfset Gestor = '#qSituacaoResp.Pos_NomeArea#'>
	  <cfset situacao = 'PONTO IMPROCEDENTE'>
	  <cfset IDArea = #strIDGestor#>
	</cfcase>
	<cfcase value=13>
	  , Pos_Situacao = 'OC'
	  , Pos_Area = '#strIDGestor#'
	  , Pos_NomeArea = '#strNomeGestor#'
	  , Pos_DtPrev_Solucao = #createodbcdate(createdate(year(dtnovoprazo),month(dtnovoprazo),day(dtnovoprazo)))#
	  <cfset Gestor = '#qSituacaoResp.Pos_NomeArea#'>
	  <cfset situacao = 'ORIENTACAO CANCELADA'>
	  <cfset IDArea = #strIDGestor#>
	</cfcase>
	<cfcase value=15>
	  , Pos_Situacao = 'TU'
	  , Pos_Area = '#strIDGestor#'
	  , Pos_NomeArea = '#strNomeGestor#'
	  , Pos_DtPrev_Solucao = #createodbcdate(createdate(year(dtnovoprazo),month(dtnovoprazo),day(dtnovoprazo)))#
	  <cfset Gestor = '#rsMod.Und_Descricao#'>
	  <cfset situacao = 'TRATAMENTO UNIDADE'>
	  <cfset IDArea = #strIDGestor#>
	  <cfset sdestina = #rsMod.Und_Email#>
  	  <cfset nomedestino = #rsMod.Und_Descricao#>
	</cfcase>
	<cfcase value=16>
	  <cfquery name="rsReop" datasource="#dsn_inspecao#">
		  SELECT Rep_Codigo, Rep_Nome, Rep_Email FROM Reops INNER JOIN Unidades ON Rep_Codigo = Und_CodReop WHERE Und_Codigo='#strIDGestor#'
      </cfquery>
	   , Pos_Situacao = 'TS'
	   , Pos_Area = '#rsReop.Rep_Codigo#'
	   , Pos_Nomearea = '#rsReop.Rep_Nome#'
	   , Pos_DtPrev_Solucao = #createodbcdate(createdate(year(dtnovoprazo),month(dtnovoprazo),day(dtnovoprazo)))#
	   <cfset Gestor = '#rsReop.Rep_Nome#'>
	   <cfset situacao = 'TRATAMENTO ORGAO SUBORDINADOR'>
	   <cfset IDArea = #rsReop.Rep_Codigo#>
	   <cfset sdestina = #rsReop.Rep_Email#>
  	   <cfset nomedestino = #rsReop.Rep_Nome#>
	 </cfcase>
	 <cfcase value=18>
	  , Pos_Situacao = 'TF'
	  , Pos_Area = '#strIDGestor#'
	  , Pos_NomeArea = '#strNomeGestor#'
	  , Pos_DtPrev_Solucao = #createodbcdate(createdate(year(dtnovoprazo),month(dtnovoprazo),day(dtnovoprazo)))#
	  <cfset Gestor = '#rsMod.Und_Descricao#'>
	  <cfset situacao = 'TRATAMENTO AGF'>
	  <cfset IDArea = #strIDGestor#>
	  <cfset sdestina = #rsMod.Und_Email#>
  	  <cfset nomedestino = #rsMod.Und_Descricao#>
	</cfcase>
	<cfcase value=19>
	    <cfquery name="qArea2" datasource="#dsn_inspecao#">
		SELECT Ars_Sigla, Ars_Email FROM Areas	WHERE Ars_Codigo = '#Form.cbArea#'
	  </cfquery>
	   , Pos_Situacao = 'TA'
	   , Pos_Area = '#Form.cbArea#'
	   , Pos_Nomearea = '#qArea2.Ars_Sigla#'
	   , Pos_DtPrev_Solucao = #createodbcdate(createdate(year(dtnovoprazo),month(dtnovoprazo),day(dtnovoprazo)))#
	   <cfset Gestor = '#qArea2.Ars_Sigla#'>
	   <cfset situacao = 'TRATAMENTO DA AREA'>
	   <cfset IDArea = #Form.cbArea#>
	   <cfset sdestina = #qArea2.Ars_Email#>
  	   <cfset nomedestino = #qArea2.Ars_Sigla#>
	</cfcase>
	<cfcase value=20>
	  , Pos_Situacao = 'PF'
	  , Pos_Area = '#strIDGestor#'
	  , Pos_NomeArea = '#strNomeGestor#'
	  , Pos_DtPrev_Solucao = #createodbcdate(createdate(year(dtnovoprazo),month(dtnovoprazo),day(dtnovoprazo)))#
	  <cfset Gestor = '#rsMod.Und_Descricao#'>
	  <cfset situacao = 'PENDENTE DE AGF'>
	  <cfset IDArea = #strIDGestor#>
	</cfcase>
	<cfcase value=21>
	  <cfquery name="qArea2" datasource="#dsn_inspecao#">
		SELECT Ars_Sigla
		FROM Areas
		WHERE Ars_Codigo = '#Form.cbArea#'
	  </cfquery>
	   , Pos_Situacao = 'RV'
	   , Pos_Area = '#Form.cbArea#'
	   , Pos_Nomearea = '#qArea2.Ars_Sigla#'
	   , Pos_DtPrev_Solucao = #createodbcdate(createdate(year(dtnovoprazo),month(dtnovoprazo),day(dtnovoprazo)))#
	   <cfset Gestor = '#qArea2.Ars_Sigla#'>
	   <cfset situacao = 'REAVALIACAO'>
	   <cfset IDArea = #Form.cbArea#>
	</cfcase>
	<!--- Status: Tratamento pela SE --->
	<cfcase value=23>
	  , Pos_Situacao = 'TO'
	  , Pos_Area = '#rsMod.Dir_Sto#'
	  , Pos_NomeArea = '#rsMod.Dir_Descricao#'
	  , Pos_DtPrev_Solucao = #createodbcdate(createdate(year(dtnovoprazo),month(dtnovoprazo),day(dtnovoprazo)))#
	  <cfset Gestor = '#rsMod.Dir_Descricao#'>
	  <cfset situacao = 'TRATAMENTO PELA SUPERINTENDÊNCIA ESTADUAL'>
	  <cfset sdestina = #rsMod.Dir_Email#>
  	  <cfset nomedestino = #rsMod.Dir_Descricao#>
	</cfcase>
  </cfswitch>
 <!--- Nro SEI da NCI --->
  <cfset aux_sei = "">
  , Pos_NCISEI =
 <cfif IsDefined("FORM.nci") AND FORM.nci EQ "Sim">
   <!--- As linhas abaixo servem para substituir o uso de aspas simples e duplas, a fim de evitar erros em instruções SQL --->
	  <cfset aux_sei = Trim(FORM.frmnumseinci)>
	  <cfset aux_sei = Replace(aux_sei,'.','',"All")>
	  <cfset aux_sei = Replace(aux_sei,'/','','All')>
      <cfset aux_sei = Replace(aux_sei,'-','','All')>
  '#aux_sei#'
   <cfelse>
  '#aux_sei#'
  </cfif>  
  <cfset aux_sei = "">
  , Pos_SEI=
  <cfif IsDefined("FORM.frmnumsei") AND len(FORM.frmnumsei) EQ 20>

   <!--- As linhas abaixo servem para substituir o uso de aspas simples e duplas, a fim de evitar erros em instruções SQL --->
	  <cfset aux_sei = Trim(FORM.frmnumsei)>
	  <cfset aux_sei = Replace(aux_sei,'.','',"All")>
	  <cfset aux_sei = Replace(aux_sei,'/','','All')>
      <cfset aux_sei = Replace(aux_sei,'-','','All')>
  '#aux_sei#'
   <cfset aux_sei = CHR(13) & CHR(13) & 'Número do SEI: ' & FORM.frmnumsei>
   <cfelse>
  '#aux_sei#'
  </cfif>
  <cfset Encaminhamento = 'Opinião do Controle Interno'>
  <cfset aux_obs = "">
  <cfif IsDefined("FORM.observacao") AND FORM.observacao NEQ "">
  , Pos_Parecer=
  <!--- As linhas abaixo servem para substituir o uso de aspas simples e duplas, a fim de evitar erros em instruções SQL --->
	  <cfset aux_obs = Trim(FORM.observacao)>
	  <cfset aux_obs = Replace(aux_obs,'"','','All')>
	  <cfset aux_obs = Replace(aux_obs,"'","","All")>
	  <cfset aux_obs = Replace(aux_obs,'*','','All')>
      <cfset aux_obs = Replace(aux_obs,'>','','All')>
	<!---	 <cfset aux_obs = Replace(aux_obs,'&','','All')>
		     <cfset aux_obs = Replace(aux_obs,'%','','All')> --->
     <cfset pos_aux = Form.H_obs & CHR(13) & CHR(13) & DateFormat(Now(),"DD/MM/YYYY") & '-' & TimeFormat(Now(),'HH:MM') & '> ' & #Trim(Encaminhamento)#  & CHR(13) & CHR(13) & 'À(O)' & '  ' & #Gestor# & CHR(13) & CHR(13) & #aux_obs# & CHR(13) & CHR(13) & 'Data de Previsão da Solução: ' & #DateFormat(dtnovoprazo,"DD/MM/YYYY")# & #aux_sei# & CHR(13) & CHR(13) & 'Situação: ' & #situacao# & CHR(13) & CHR(13) &  'Responsável: ' & #CGI.REMOTE_USER# & '\' & Trim(qUsuario.Usu_LotacaoNome) & CHR(13) & CHR(13) & '-----------------------------------------------------------------------------------------------------------------------'>
	'#pos_aux#'
    </cfif>
	<cfif IsDefined("FORM.abertura") AND FORM.abertura EQ "Sim">
    , Pos_Abertura = '#FORM.abertura#'
	, Pos_Processo =
	<cfset proc_se = FORM.proc_se>
	<cfset proc_num = FORM.proc_num>
	<cfset proc_ano = FORM.proc_ano>
    <cfset Processo = proc_se & proc_num & proc_ano>
	#Processo#
    , Pos_Tipo_Processo = '#FORM.modalidade#'
	<cfelse>
	, Pos_Abertura = ''
	, Pos_Processo = ''
    , Pos_Tipo_Processo = ''
    </cfif>
	<cfif IsDefined("FORM.VLRecuperado") AND FORM.VLRecuperado NEQ "">
	  <cfset aux_vlr = Trim(FORM.VLRecuperado)>
	  <cfset aux_vlr = Replace(aux_vlr,'.','','All')>
	  <cfset aux_vlr = Replace(aux_vlr,',','.','All')>
    , Pos_VLRecuperado='#aux_vlr#'
    </cfif>
   	, pos_username = '#CGI.REMOTE_USER#'
	, Pos_DtPosic = #createodbcdate(CreateDate(Year(Now()),Month(Now()),Day(Now())))#
	, pos_dtultatu = GETDATE()
	WHERE Pos_Unidade= '#FORM.unid#' AND Pos_Inspecao='#FORM.ninsp#' AND Pos_NumGrupo=#FORM.ngrup# AND Pos_NumItem=#FORM.nitem#
 </cfquery>
<!---  --->
<cfif FORM.frmReinccb neq FORM.db_reincSN>
	 <cfquery datasource="#dsn_inspecao#">
		UPDATE Resultado_Inspecao SET
		 , RIP_ReincInspecao = '#FORM.frmreincInsp#'
		 , RIP_ReincGrupo = #FORM.frmreincGrup#
		 , RIP_ReincItem = #FORM.frmreincItem#
		 , RIP_UserName = '#CGI.REMOTE_USER#'
		 , RIP_DtUltAtu = CONVERT(char, GETDATE(), 102)
		 WHERE RIP_Unidade='#FORM.unid#' AND RIP_NumInspecao='#FORM.ninsp#' AND RIP_NumGrupo=#FORM.ngrup# AND RIP_NumItem=#FORM.nitem#
	 </cfquery>
<cfelse>
		<cfquery datasource="#dsn_inspecao#">
		UPDATE Resultado_Inspecao SET 
		   RIP_ReincInspecao = ''
		 , RIP_ReincGrupo = ''
		 , RIP_ReincItem = ''
		 , RIP_UserName = '#CGI.REMOTE_USER#'
		 , RIP_DtUltAtu = CONVERT(char, GETDATE(), 102)
		 WHERE RIP_Unidade='#FORM.unid#' AND RIP_NumInspecao='#FORM.ninsp#' AND RIP_NumGrupo=#FORM.ngrup# AND RIP_NumItem=#FORM.nitem#
	 </cfquery>	 
 </cfif>
 
 <cfquery name="rsMod" datasource="#dsn_inspecao#">
		SELECT Und_Descricao, Und_CodReop, Und_Codigo, Und_CodDiretoria, Und_Email, Dir_Descricao, Dir_Codigo, Dir_Sigla, Dir_Sto, Dir_Email
		FROM Unidades INNER JOIN Diretoria ON Und_CodDiretoria = Dir_Codigo
		WHERE Und_Codigo = '#FORM.unid#'
</cfquery>
<!---  --->
<cfif IsDefined("FORM.MM_UpdateRecord") AND FORM.MM_UpdateRecord EQ "form1" And IsDefined("FORM.acao") And Form.acao is "Salvar2">

  <cfquery datasource="#dsn_inspecao#">
   INSERT Andamento (And_NumInspecao, And_Unidade, And_NumGrupo, And_NumItem, And_DtPosic, And_username, And_Situacao_Resp, And_HrPosic, and_Parecer, And_Orgao_Solucao)
   VALUES (
   <cfif IsDefined("form.Ninsp") AND form.Ninsp NEQ "">
   '#form.ninsp#'
      <cfelse>
      NULL
   </cfif>
   ,
   <cfif IsDefined("form.Unid") AND form.Unid NEQ "">
   '#form.unid#'
      <cfelse>
      NULL
   </cfif>
   ,
   <cfif IsDefined("form.Ngrup") AND form.Ngrup NEQ "">
   #form.Ngrup#
      <cfelse>
      NULL
   </cfif>
   ,
   <cfif IsDefined("form.Nitem") AND form.Nitem NEQ "">
   #form.Nitem#
      <cfelse>
      NULL
   </cfif>
   ,
   convert(char, getdate(), 102),
   '#CGI.REMOTE_USER#'
   ,
   <cfif IsDefined("FORM.frmResp") AND FORM.frmResp NEQ "N">
   #FORM.frmResp#
      <cfelse>
      NULL
   </cfif>
   ,
  CONVERT(char, GETDATE(), 108)
   ,
  <cfif IsDefined("FORM.observacao") AND FORM.observacao NEQ "">
     <cfset and_obs = DateFormat(Now(),"DD/MM/YYYY") & '-' & TimeFormat(Now(),'HH:MM') & '> ' & #Trim(Encaminhamento)#  & CHR(13) & CHR(13) & 'À(O)' & '  ' & #Gestor# & CHR(13) & CHR(13) & #aux_obs# & CHR(13) & CHR(13) & 'Data de Previsão da Solução: ' & #DateFormat(dtnovoprazo,"DD/MM/YYYY")# & CHR(13) & CHR(13) & #aux_sei# & CHR(13) & CHR(13) & 'Situação: ' & #situacao# & CHR(13) & CHR(13) &  'Responsável: ' & #CGI.REMOTE_USER# & '\' & Trim(qUsuario.Usu_LotacaoNome) & CHR(13) & CHR(13) & '-----------------------------------------------------------------------------------------------------------------------'>
  '#and_obs#'
  <cfelse>
   NULL
  </cfif>
  ,
  '#IDArea#'
  )
 </cfquery>
</cfif>

  <!--- Encerramento do processo --->
  <cfif IsDefined("FORM.frmResp") AND FORM.frmResp EQ "3">
    <cfquery name="qVerificaEncerramento" datasource="#dsn_inspecao#">
      SELECT COUNT(Pos_Inspecao) AS vTotal
      FROM ParecerUnidade
      WHERE Pos_Unidade='#FORM.unid#' AND Pos_Inspecao='#FORM.ninsp#' AND Pos_Situacao_Resp <> '3'
    </cfquery>
    <cfif qVerificaEncerramento.vTotal is 0>
      <cfquery datasource="#dsn_inspecao#">
        UPDATE ProcessoParecerUnidade SET Pro_Situacao = 'EN', Pro_DtEncerr = CONVERT(char, GETDATE(), 102)
        WHERE Pro_Unidade='#FORM.unid#' AND Pro_Inspecao='#FORM.ninsp#'
      </cfquery>
    </cfif>
  </cfif>
<!--- Envio de aviso por email para Situação = Tratamento --->

<cfif Form.frmResp is 15 or Form.frmResp is 16 or Form.frmResp is 18 or Form.frmResp is 19 or Form.frmResp is 23>
	  <cfoutput>
		<cfif Form.frmResp is 15 or Form.frmResp is 18>
			<!--- Participar ao Orgão subordinador --->
			 <cfquery name="rsOrgSub" datasource="#dsn_inspecao#">
				SELECT Rep_Email FROM Reops INNER JOIN Unidades ON Rep_Codigo = Und_CodReop WHERE Und_Codigo='#strIDGestor#'
			 </cfquery>
			 <cfset sdestina = #sdestina# & ';' & #rsOrgSub.Rep_Email#>
		</cfif>
	  
	  <cfif findoneof("@", trim(sdestina)) eq 0>
	    <cfset sdestina = "gilvanm@correios.com.br">
	  </cfif>
  	  <cfif left(form.ninsp,2) is '20'>
		 <cfset sdestina = #sdestina# & ';fsobrinho@correios.com.br'>
	  </cfif>
<!--- 	  <cfset sdestina = #sdestina# & ';' & #Form.emailusu#> --->

	  <!---  <cfset sdestina = "gilvanm@correios.com.br">  --->
	  <cfmail from="SNCI@correios.com.br" to="#sdestina#" subject="Relatório Item Em Tratamento" type="HTML">
			 Mensagem automática. Não precisa responder!<br><br>
			<strong>
			   Ao Gestor do(a) #nomedestino#. <br><br><br>

	&nbsp;&nbsp;&nbsp;Para conhecimento deste Órgão.<br><br>

	&nbsp;&nbsp;&nbsp;Comunicamos que há pontos de Controle Interno "Em Tratamento" de manifestação/Solução.<br><br>

	&nbsp;&nbsp;&nbsp;Unidade: #FORM.unid#, Inspeção: #form.ninsp#, Grupo: #form.Ngrup#, Item: #form.Nitem# e Data de Previsão Solução: #DateFormat(dtnovoprazo,"DD/MM/YYYY")#.<br><br>

	&nbsp;&nbsp;&nbsp;O registro da manifestação está disponível no link: <a href="http://intranetsistemaspe/snci/rotinas_inspecao.cfm">Relatório Item Em Tratamento.</a><br><br>

	&nbsp;&nbsp;&nbsp;Desde já agradecemos a sua atenção.
	</strong>
	</cfmail>
	</cfoutput>
</cfif>
<!---  --->

</cfif>


<!--- Nova consulta para verificar respostas das unidades --->

<cfquery name="qResposta" datasource="#dsn_inspecao#">
SELECT Pos_Area, Pos_NomeArea, Pos_Situacao_Resp, Pos_Parecer, RIP_Recomendacoes, RIP_Comentario, RIP_Caractvlr, RIP_Falta, RIP_Sobra, RIP_EmRisco, RIP_Valor, RIP_ReincInspecao, RIP_ReincGrupo, RIP_ReincItem, Dir_Descricao, Dir_Codigo, Pos_Processo, Pos_Tipo_Processo, Pos_Abertura, Itn_Descricao, Itn_TipoUnidade, Pos_VLRecuperado, Pos_DtPrev_Solucao, Pos_DtPosic, DATEDIFF(dd,Pos_DtPosic,GETDATE()) AS diasOcor, Pos_SEI, INP_DtInicInspecao, Pos_NCISEI
 FROM  Inspecao INNER JOIN (Diretoria INNER JOIN ((Resultado_Inspecao INNER JOIN ParecerUnidade ON (RIP_NumItem = Pos_NumItem) AND (RIP_NumGrupo = Pos_NumGrupo) AND (RIP_NumInspecao = Pos_Inspecao) AND (RIP_Unidade = Pos_Unidade)) INNER JOIN (Itens_Verificacao INNER JOIN Grupos_Verificacao ON Itn_NumGrupo = Grp_Codigo) ON (Pos_NumGrupo = Itn_NumGrupo) AND (Pos_NumItem = Itn_NumItem)) ON Dir_Codigo = RIP_CodDiretoria) ON (INP_NumInspecao = RIP_NumInspecao) AND (INP_Unidade = RIP_Unidade)
 WHERE Pos_Unidade='#URL.unid#' AND Pos_Inspecao='#URL.ninsp#' AND Pos_NumGrupo=#URL.ngrup# AND Pos_NumItem=#URL.nitem#
</cfquery>

<cfquery name="qInspetor" datasource="#dsn_inspecao#">
 SELECT IPT_MatricInspetor, Fun_Nome
 FROM Inspetor_Inspecao INNER JOIN Funcionarios ON IPT_MatricInspetor = Fun_Matric AND IPT_MatricInspetor =
 Fun_Matric WHERE IPT_NumInspecao = '#URL.Ninsp#'
</cfquery>

<cfquery name="qArea" datasource="#dsn_inspecao#">
 SELECT DISTINCT Ars_Codigo, Ars_Sigla
 FROM Areas WHERE Ars_Status = 'A' AND (Left(Ars_Codigo,2) = '#rsMod.Dir_Codigo#')
 ORDER BY Ars_Sigla
</cfquery>

<cfquery name="qAreaCS" datasource="#dsn_inspecao#">
 SELECT DISTINCT Ars_Codigo, Ars_Sigla
 FROM Areas WHERE Ars_Status = 'A' AND (Left(Ars_Codigo,2) = '01')
 ORDER BY Ars_Sigla
</cfquery>


<cfquery name="qCausaProcesso" datasource="#dsn_inspecao#">
 SELECT Cpr_Codigo, Cpr_Descricao, PCP_Unidade, PCP_CodCausaProvavel  FROM ParecerCausaProvavel INNER JOIN CausaProvavel ON PCP_CodCausaProvavel =
 Cpr_Codigo WHERE PCP_Unidade='#URL.unid#' AND PCP_Inspecao='#URL.ninsp#' AND PCP_NumGrupo=#URL.ngrup# AND PCP_NumItem=#URL.nitem#
</cfquery>

<cfquery name="rsTPUnid" datasource="#dsn_inspecao#">
     SELECT Und_Codigo, Und_Descricao, Und_TipoUnidade FROM Unidades WHERE Und_Codigo = '#URL.unid#'
</cfquery>
<cfif rsTPUnid.Und_TipoUnidade is 12>
    <cfif left(ninsp,2) is '50' or left(ninsp,2) is '72'>
		<cfquery name="rsPonto" datasource="#dsn_inspecao#">
		  SELECT STO_Codigo, STO_Descricao FROM Situacao_Ponto WHERE STO_Status='A' AND STO_Codigo <> 1 AND STO_Codigo <> 6 AND STO_Codigo <> 7 AND STO_Codigo <> 11 AND STO_Codigo <> 14 AND STO_Codigo <> 15  AND STO_Codigo <> 17 AND STO_Codigo <> 2 AND STO_Codigo <> 20 AND STO_Codigo <> 22 order by STO_Descricao
		</cfquery>
	<cfelse>
	<!--- <cfset gil=gil> --->
        <cfquery name="rsPonto" datasource="#dsn_inspecao#">
		  SELECT STO_Codigo, STO_Descricao FROM Situacao_Ponto WHERE STO_Status='A' AND STO_Codigo <> 1 AND STO_Codigo <> 4 AND STO_Codigo <> 6 AND STO_Codigo <> 7 AND STO_Codigo <> 11 AND STO_Codigo <> 14 AND STO_Codigo <> 15  AND STO_Codigo <> 17 AND STO_Codigo <> 2 AND STO_Codigo <> 16 AND STO_Codigo <> 20 AND STO_Codigo <> 22 order by STO_Descricao
		</cfquery>
	</cfif>
<cfelse>
	<cfquery name="rsPonto" datasource="#dsn_inspecao#">
	 SELECT STO_Codigo, STO_Descricao FROM Situacao_Ponto WHERE STO_Status='A' AND STO_Codigo <> 1 AND STO_Codigo <> 6 AND STO_Codigo <> 7 AND STO_Codigo <> 11 AND STO_Codigo <> 14 AND STO_Codigo <> 18  AND STO_Codigo <> 17 AND STO_Codigo <> 20 AND STO_Codigo <> 22 order by STO_Descricao
	</cfquery>
</cfif>


<cfset vRecom = 0>
<cfset vRecomendacao = Trim(qResposta.RIP_Recomendacoes)>

<cfif vRecomendacao is ''>
   <cfset vRecom = 1>
</cfif>

<html>
<head>
<title>Sistema Nacional de Controle Interno</title>
<link href="CSS.css" rel="stylesheet" type="text/css">
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">

<script>
/*
function aviso(){

if (confirm ("AVISO IMPORTANTE \n\nCaro Colaborador(a), você informou uma nova Data de Previsão da Solução; requisitamos que registre em sua opinião a motivação da mudança.\n\nDo contrário deixe a Data de Previsão da Solução sem mudança\n\nConfirma a nova Data de Previsão?")){
   document.form1.frmnovoprazo.value='S';
	}
else
   {
   document.form1.frmnovoprazo.value='N';
   //document.form1.cbData.value = document.form1.frmdtprevsol.value;
   }
}
*/
// travar o combobox(cbArea) em um determinado valor
function buscaopt(a) {
//alert(a);
   var opt_sn = 'N';
   var comboitem = document.getElementById("cbArea");
   for (i = 1; i < comboitem.length; i++) {
       // comparando o valor do label
       if (comboitem.options[i].text.substring(comboitem.options[i].text.indexOf("/") + 1,comboitem.options[i].text.length) ==  a)
	   {
       //     alert(i);
		  opt_sn = 'S'
          comboitem.selectedIndex = i;
          comboitem.disabled=true;
          i = comboitem.length;
         }
    }
	if (opt_sn == "N")
	{
       //    alert(i);
       comboitem.selectedIndex = 0;
       comboitem.disabled=true;
    }
}
// recomposição na saida do campo com nulo
function exibirMoeda(a,b,c,d){
//alert(a + '    ' + b + '    ' + c  + '    ' + d);
//alert(a.length)
//tratar o evento onchange
if (a.length == 0 || a == 0 || a == '') { a = '0';} 

// remover ponot e virgula
 var aux = '';

var x = 0;
var comp = 1;
//alert(a);
while (x < a.length)
{
  if (a.substring(x, comp) != '.' && a.substring(x, comp) != ',') 
  { 
  aux = aux + a.substring(x, comp)} 
  x++
  comp++
  //alert(aux);
   
}

// editoração da moeda
switch (aux.length) {
  case 0:
    aux = "0,00";
    break;
  case 1:
    aux = "0,0" + aux
    break;
  case 2:
    aux = "0," + aux
    break;
  case 3:
	 aux = aux.substring(0,1) + ',' + aux.substring(1,aux.length);
    break;
  case 4:
    aux = aux.substring(0,2) + ',' + aux.substring(2,aux.length);
    break;
  case 5:
	aux = aux.substring(0,3) + ',' + aux.substring(3,aux.length);
    break;
  case 6:
	aux = aux.substring(0,1) + '.' + aux.substring(1,4) + ',' + aux.substring(4,aux.length);
    break;
  case 7:
	aux = aux.substring(0,2) + '.' + aux.substring(2,5) + ',' + aux.substring(5,aux.length);
	break;
  case 8:
	aux = aux.substring(0,3) + '.' + aux.substring(3,6) + ',' + aux.substring(6,aux.length);
    break;
  case 9:
	aux = aux.substring(0,1) + '.' + aux.substring(1,4) + '.' + aux.substring(4,7) + ',' + aux.substring(7,aux.length);
    break;
  case 10:
	aux = aux.substring(0,2) + '.' + aux.substring(2,5) + '.' + aux.substring(5,8) + ',' + aux.substring(8,aux.length);
	break;
  case 11:
    aux = aux.substring(0,3) + '.' + aux.substring(3,6) + '.' + aux.substring(6,9) + ',' + aux.substring(9,aux.length);
	break;
  case 12:
    aux = aux.substring(0,1) + '.' + aux.substring(1,4) + '.' + aux.substring(4,7) + '.' + aux.substring(7,10) + ',' + aux.substring(10,aux.length);
	break;
}

if (d == 0){
    if (c == 'frmfalta') {document.form1.frmfalta.value = aux;}
	if (c == 'frmsobra') {document.form1.frmsobra.value = aux;}
	if (c == 'frmemrisco') {document.form1.frmemrisco.value = aux;}
	if (c == 'VLRecuperado') {document.form1.VLRecuperado.value = aux;}
 }
//tratar o evento dblclick ==========================
if (d == 'DC' && (a.length == 0 || a == '' || a == 0 || a == '0,00')) { 
    if (c == 'frmfalta') {document.form1.frmfalta.value = b;}
	if (c == 'frmsobra') {document.form1.frmsobra.value = b;}
	if (c == 'frmemrisco') {document.form1.frmemrisco.value = b;}
	if (c == 'VLRecuperado') {document.form1.VLRecuperado.value = b;}
}
}

//permite digitaçao apenas de valores numéricos e vírgula
function moedas(a,b) {
//return false;
var tecla = window.event.keyCode;
//alert(tecla);

if (a.length != 16 && tecla != 13 && tecla != 32 && tecla != 44 && tecla != 46) {
// ==================================
//tratar o evento onchange
if (a.length == 0 || a == 0 || a == '') { a = '0';} 

// remover ponto e virgula
 var aux = '';

var x = 0;
var comp = 1;

while (x < a.length)
{
  if (a.substring(x, comp) != '.' && a.substring(x, comp) != ',') 
  { 
  aux = aux + a.substring(x, comp)} 
  x++
  comp++
}
aux = parseInt(aux,10);
aux = aux.toString();
//alert('Valor de aux: ' + aux + 'tamanho: ' + aux.length);
// editoração da moeda
switch (aux.length) {
  case 0:
    aux = "0,0";
    break;
  case 1:
    aux = "0," + aux
    break;
  case 2:
    aux = aux = aux.substring(0,1) + ',' + aux.substring(1,aux.length);
    break;
  case 3:
	 aux = aux.substring(0,2) + ',' + aux.substring(2,aux.length);
    break;
  case 4:
    aux = aux.substring(0,3) + ',' + aux.substring(3,aux.length);
    break;
  case 5:
	aux = aux.substring(0,1) + '.' + aux.substring(1,4) + ',' + aux.substring(4,aux.length);
    break;
  case 6:
	aux = aux.substring(0,2) + '.' + aux.substring(2,5) + ',' + aux.substring(5,aux.length);
    break;
  case 7:
	aux = aux.substring(0,3) + '.' + aux.substring(3,6) + ',' + aux.substring(6,aux.length);
	break;
  case 8:
	aux = aux.substring(0,1) + '.' + aux.substring(1,4) + '.' + aux.substring(4,7) + ',' + aux.substring(7,aux.length);
    break;
  case 9:
	aux = aux.substring(0,2) + '.' + aux.substring(2,5) + '.' + aux.substring(5,8) + ',' + aux.substring(8,aux.length);
    break;
  case 10:
	aux = aux.substring(0,3) + '.' + aux.substring(3,6) + '.' + aux.substring(6,9) + ',' + aux.substring(9,aux.length);
	break;
  case 11:
    aux = aux.substring(0,1) + '.' + aux.substring(1,4) + '.' + aux.substring(4,7) + '.' + aux.substring(7,10) + ',' + aux.substring(10,aux.length);
	break;
}
//alert('valor de a: ' + a + ' Valor de b: ' + b + 'valor aux ' + aux);
	if (b == 'frmfalta') {document.form1.frmfalta.value = aux;}
	if (b == 'frmsobra') {document.form1.frmsobra.value = aux;}
	if (b == 'frmemrisco') {document.form1.frmemrisco.value = aux;}
	if (b == 'VLRecuperado') {document.form1.VLRecuperado.value = aux;}
 } 
 else 
 {
 event.returnValue = false;
 return false;
 }
   
  } 
//===============
//permite digitaçao apenas de valores numéricos
function numericos(x) {
var tecla = window.event.keyCode;
//permite digitação das teclas numéricas (48 a 57, 96 a 105), Delete e Backspace (8 e 46), TAB (9) e ESC (27)
//if ((tecla != 8) && (tecla != 9) && (tecla != 27) && (tecla != 46)) {

 if ((tecla < 48) || (tecla > 57)) {
		//alert(tecla);
	//  if (tecla != 44) {
		event.returnValue = false;
	// }
	}
//}
}
//================
function validacao()
	{
		var ctrl=window.event.ctrlKey;

		var tecla=window.event.keyCode;
/*
		if (ctrl && tecla==67) {
			alert("CTRL+C");
			event.keyCode=0;
			event.returnValue=false;
		}
*/
		if (ctrl && tecla==86) {
			//alert("CTRL+V não permitido!");
			event.keyCode=0;
			event.returnValue=false;
		}
	}
//================
function Mascara_SEI(x)
{
	switch (x.value.length)
	{
		case 5:
		  x.value += ".";
		  break;
		case 12:
		  x.value += "/";
		  break;
		case 17:
		  x.value += "-";
		  break;
	}
}
//================
function Mascara_Data(data)
{
	switch (data.value.length)
	{
		case 2:
		   if (data.value < 1 || data.value > 31) {
		      alert('Valor para o dia inválido!');
			  data.value = '';
		      event.returnValue = false;
			  break;
		    } else {
			  data.value += "/";
				break;
			}
		case 5:
			if (data.value.substring(3,5) < 1 || data.value.substring(3,5) > 12) {
		      alert('Valor para o Mês inválido!');
			  data.value = '';
		      event.returnValue = false;
			  break;
		    } else {
			  data.value += "/";
				break;
			}
	}
}
//=================
function exibevalores()
{
 //alert(document.form1.sfrmfalta.value);
  var caracvlr = document.form1.caracvlr.value;
  if (caracvlr == 'Quantificado')
  {
     document.form1.frmfalta.disabled = false;
     document.form1.frmsobra.disabled = false;
	 document.form1.frmemrisco.disabled = false;
	 document.form1.frmfalta.value = document.form1.sfrmfalta.value;
	 document.form1.frmsobra.value = document.form1.sfrmsobra.value;
	 document.form1.frmemrisco.value = document.form1.sfrmemrisco.value;
  }
  if (caracvlr != 'Quantificado') {
     document.form1.frmfalta.value = '0,00';
     document.form1.frmsobra.value = '0,00';
	 document.form1.frmemrisco.value = '0,00';
     document.form1.frmfalta.disabled = true;
     document.form1.frmsobra.disabled = true;
	 document.form1.frmemrisco.disabled = true;
  }
}
//=================
function dtprazo(k){
 document.form1.cbData.disabled = true;
 document.form1.cbData.value = document.form1.frmdtprevsol.value;
 //alert('dtprazo: ' + k);
 if (k == 3 || k == 10 || k == 12 || k == 13)
 {
   document.form1.cbData.value = document.form1.dtdehoje.value;
   document.form1.cbData.disabled = true;
 }
 if (k == 2 || k == 4 || k == 5 || k == 8  || k == 20)
 {
   document.form1.cbData.value = document.form1.dtdezdiasfut.value;
   document.form1.cbData.disabled = true;
 }
 if (k == 15 || k == 16 || k == 18 || k == 19 || k == 21 || k == 23)
 {
  //alert('dtprazo: ' + k);
   document.form1.cbData.disabled = false;
 }
 }
 //========================
 function hanci(){
//	alert(document.form1.nseincirel.value);
 var x=document.form1.nci.value;
 var k=document.form1.nseincirel.value;
 window.ncisei.style.visibility = 'hidden';
  if (x=='Sim'){
    window.ncisei.style.visibility = 'visible';
    document.form1.frmnumseinci.value = document.form1.nseincirel.value;
    if (k.length != 10)
    {
	 // document.form1.frmnumseinci.disabled=true;
	}
  }
}
//=========================
function proc_disc(){
 var x=document.form1.abertura.value;
 window.dproc.style.visibility = 'hidden';
  if (x=='Sim'){
    window.dproc.style.visibility = 'visible';
  }
}
//=================
function exibe(a){
 // alert(a);
  exibirArea(a);
  exibirAreaCS(a);
  exibirValor(a);
  dtprazo(a);
}
var ind;
function exibirArea(ind){
//alert('exibirArea: ' + ind);
  document.form1.cbArea.disabled=false;
  if (ind==5 || ind==10 || ind==19 || ind==21){
    window.dArea.style.visibility = 'visible';
	if(ind==21) {buscaopt('DCINT/GCOP/CVCO')}
  } else {
    window.dArea.style.visibility = 'hidden';
	document.form1.cbArea.value = '';
  }
}
var idx;
function exibirAreaCS(idx){
//alert('exibirAreaCS: ' + idx);
  if (idx==9){
    window.dAreaCS.style.visibility = 'visible';
  } else {
    window.dAreaCS.style.visibility = 'hidden';
	document.form1.cbAreaCS.value = '';
  }
}
var dat;
function exibirData(dat){
//alert('exibirData: ' + dat);
  if (dat==2 || dat==4 || dat==5 || dat==8 || dat==20 || dat==21){
  //  window.dData.style.visibility = 'visible';
  } else {
 //   window.dData.style.visibility = 'hidden';
	//document.form1.cbData.value = '';
  }
}
var vlr;
function exibirValor(vlr){
//alert('exibirValor: ' + vlr);
  //if ((vlr==3 || vlr==9) && document.form1.vlrdeclarado.value == 'S'){
  if (vlr==3 || vlr==9){
    window.dValor.style.visibility = 'visible';
   // alert('Sr. Gestor, informe o Valor Regularizado, Exemplos: 1185,40; 0,07');
	document.form1.VLRecuperado.value='0,00'
	if (document.form1.vlrdeclarado.value == 'N'){document.form1.VLRecuperado.value='0,0'}
  } else {
    document.form1.VLRecuperado.value='0,00'
    window.dValor.style.visibility = 'hidden';
  }
}
//=================
function reincidencia(a){
alert(a);
 if (a == 'N')
  {
   document.form1.frmreincInsp.value = '';
   document.form1.frmreincGrup.value = '0';
   document.form1.frmreincItem.value = '0';
   document.form1.frmreincInsp.disabled = true;
   document.form1.frmreincGrup.disabled = true;
   document.form1.frmreincItem.disabled = true;
  } 
  else 
  {
   document.form1.frmreincInsp.disabled = false;
   document.form1.frmreincGrup.disabled = false;
   document.form1.frmreincItem.disabled = false;
   alert(document.form1.dbreincInsp.value);
   document.form1.frmreincInsp.value = document.form1.dbreincInsp.value;
   document.form1.frmreincGrup.value = document.form1.dbreincGrup.value;
   document.form1.frmreincItem.value = document.form1.dbreincItem.value;
  }
 }
//=============================================================
function validarform(){
//var tamresp = document.form1.frmResp.value;
//alert('acao: ' + document.form1.acao.value + ' resposta:' + document.form1.frmResp.value + ' tamanho: ' + tamresp.length);
  if (document.form1.acao.value=='Anexar'){
	  return true;
  }
  if (document.form1.acao.value=='Excluir'){
	  return true;
  }
  if (document.form1.acao.value=='Excluir_Causa'){
	  return true;
  }
  // inicio críticas para o botão Salvar manifestação
  if (document.form1.acao.value == 'Salvar2')
  {
     var sit = document.form1.frmResp.value;
	 if (document.form1.causasprovSN.value=='N')
	 {
    //    alert('Sr. Gestor, selecione e Inclua uma causa provável');
	//    return false;
	  }
    if (document.form1.frmResp.value == 'N')
		  {
				 alert('Sr. Gestor, Escolha uma das Situações para a Oportunidade de Aprimoramento.');
				 return false;
		}
    //----------------------------------------------
	if (document.form1.nci.value == 'Sim')
		{
			// controle de dados do N.SEI da NCI
		var nsnci = document.form1.frmnumseinci.value;
		if (nsnci.length != 20)
		{
			alert('Nº do SEI da NCI      Inválido!:  (ex. 99999.999999/9999-99)');
			return false;
		}
	   }
		
	 if (document.form1.abertura.value == 'Sim')
		{
			var procse = document.form1.proc_se.value;
			var procnum = document.form1.proc_num.value;
			var procano = document.form1.proc_ano.value;
			var ano = document.form1.auxano.value;
			var modalid = document.form1.modalidade.value;

			if (procse != document.form1.SE.value)
			{
			alert('Sr. Gestor, o Nº da SE informado difere ao deste Nº de Relatório.')
			 return false;
			}

			if ((procnum.length != 5) || (procnum.indexOf(' ') != -1) || (procano.length != 2) || (procano.indexOf(' ') != -1))
			{
			alert('Sr. Gestor, o Campo Nº Processo deve conter nove dígitos numéricos ex: 99-99999-99 (Nº SE+99999+ANO)')
			 return false;
			}

			if (procano > ano)
			{
			alert('Sr. Gestor, campo ano do Nº Processo inválido!');
			 return false;
			}
			if (modalid == '')
			{
			alert('Sr. Gestor, selecionar uma opção no campo Modalidade')
			 return false;
			}
	   }
     if (sit == 21) {document.form1.cbArea.disabled = false;}
	  if ((sit == 5 || sit == 10 || sit == 19 || sit == 21) && (document.form1.cbArea.value == ''))
	  {
		   alert('Sr. Gestor, informe a Área para encaminhamento!');
		   return false;
	  }

	  if (document.form1.frmResp.value == 9)
	  {
		if (document.form1.cbAreaCS.value == '')
		{
		   alert('Sr. Gestor, informe a Área para encaminhamento!');
		   return false;
		}
	  }

	 var strmanifesto = document.form1.observacao.value;
	  if (strmanifesto == '')
	  {
		   alert('Caro Usuário, falta o seu Posicionamento no campo Manifestar-se!');
		   return false;
	  }
	 if (strmanifesto.length < 100)
	 {
		   alert('Sr. Gestor(a)! Sua manisfestação deverá conter no mínimo 100(cem) caracteres');
		   return false;
	 }
      document.form1.cbData.disabled = false;
	  var dtprevdig = document.form1.cbData.value;
	  if (dtprevdig.length != 10)
	  {
		alert('Preencher campo: Data da Previsão da Solução ex. DD/MM/AAAA');
		dtprazo(sit);
		return false;
	  }
		// controle de dados do Nro SEI da Apuração
		var numsei = document.form1.frmnumsei.value;
		if (numsei.length > 0 && numsei.length < 20)
		{
			alert('Nº SEI da Apuração       Inválido!:  (ex. 99999.999999/9999-99)');
			return false;
		}

	<!--- formato AAAAMMDD --->
		 var dt_hoje_yyyymmdd = document.form1.dthojeyyyymmdd.value;
		 //alert(a);
		 var vDia = dtprevdig.substr(0,2);
		 var vMes = dtprevdig.substr(3,2);
		 var vAno = dtprevdig.substr(6,10);
		 var dtprevdig_yyyymmdd = vAno + vMes + vDia

		 if (dt_hoje_yyyymmdd > dtprevdig_yyyymmdd)
		 {
		  alert("Data de Previsão da Solução deve ser superior a data corrente(do dia)!")
		  //dtprazo(sit);
		  return false;
		 }

	    if ((sit == 15 || sit == 16 || sit == 18 || sit == 19 || sit == 23) && (dt_hoje_yyyymmdd == dtprevdig_yyyymmdd))
		 {
          alert('Para Tratamento a Data de Previsão da Solução deve ser maior que a do dia!')
		  //dtprazo(sit);
		  return false;
		 }
	  //============
	  	var reincInsp = document.form1.frmreincInsp.value;
		var reincGrup = document.form1.frmreincGrup.value;
		var reincItem = document.form1.frmreincItem.value;

		if (document.form1.frmReinccb.value == 'S' && (reincInsp.length != 10 || reincGrup == 0 || reincItem == 0))
		{
		 alert('Para o Reincidência: Sim é preciso informar Nro Inspeção, Nro Grupo e Nro Item!');
		 return false;
		} else {
		document.form1.frmreincInsp.disabled = false;
        document.form1.frmreincGrup.disabled = false;
        document.form1.frmreincItem.disabled = false;
		}
		
	//============
	     if (sit == 15 || sit == 16 || sit == 18 || sit == 19 || sit == 23) {var auxcam = '\n\nTRATAMENTO\n\n - AVISO IMPORTANTE \n\nCaro Colaborador(a), você informou uma nova Data de Previsão da Solução;\n\nNos casos em que foi cedido dilatação de prazo, requisitamos que registre em sua opinião a motivação da mudança.\n\nConfirma a nova Data de Previsão?';

	 if (confirm ('            Atenção! ' + auxcam))
	    {
	     document.form1.cbData.disabled = false;
		 return true;
		}
	else
	   {
	   if (sit != 15 && sit != 16 && sit != 18 && sit != 19 && sit != 23) {document.form1.cbData.disabled = true;}
	   return false;
	   }
	   }
	document.form1.cbArea.disabled=false;
    //============
}
  // ==== critica do botão incluir causa ===
     if (document.form1.acao.value == 'Incluir_Causa')
	 {
		   if (document.form1.causaprovavel.value == '')
		   {
		   alert('Selecione uma Causa Provável a ser incluída.');
		   return false;
		   }
		   if (document.form1.causaprovavel.value != '')
		   {
		   //======================================
			   var cmbcausaprov = document.getElementById("causaprovavel");
			   for (i = 1; i < cmbcausaprov.length; i++)
			   {
					// alert(cmbcausaprov.options[i].value);
					if (cmbcausaprov.options[i].value ==  document.form1.causaprovavel.value)
					{
                             // alert(cmbcausaprov.options[i].text);
							 if (confirm ('Confirma a inclusão da Causa Provável: ' + cmbcausaprov.options[i].text + ' ?'))
							   {
								}
							else
							   {
							   return false;
							   }
					    i = cmbcausaprov.length;
					 }
				}
	     }
	//return false;
   }
  //=====================================
  // ==== critica do botão Salvar ===
     if (document.form1.acao.value == 'Salvar')
	 {
	    var melhor = document.form1.Melhoria.value;
	    var recomed = document.form1.recomendacao.value;
	 	if (melhor.length < 100 || recomed.length < 100)
		{
		 alert('Gestor(a), os campos: Oportunidade de Aprimoramento e/ou Orientações devem conter no mínimo 100(cem) caracteres!');
		 return false;
		}
	    var caracvlr = document.form1.caracvlr.value;
		var falta = document.form1.frmfalta.value;
		var sobra = document.form1.frmsobra.value;
		var emrisco = document.form1.frmemrisco.value;

		if (caracvlr == 'Quantificado' && (falta == '' || falta == '0,00') && (sobra == '' || sobra == '0,00') && (emrisco == '' || emrisco == '0,00'))
		{
		 alert('Para o Caracteres: Quantificado deve informar os campos Falta e ou Sobra e ou Em Risco!');
		 return false;
		}
		
		var reincInsp = document.form1.frmreincInsp.value;
		var reincGrup = document.form1.frmreincGrup.value;
		var reincItem = document.form1.frmreincItem.value;

		if (document.form1.frmReinccb.value == 'S' && (reincInsp.length != 10 || reincGrup == 0 || reincItem == 0))
		{
		 alert('Para o Reincidência: Sim é preciso informar Nro Inspeção, Nro Grupo e Nro Item!');
		 return false;
		} else {
		document.form1.frmreincInsp.disabled = false;
        document.form1.frmreincGrup.disabled = false;
        document.form1.frmreincItem.disabled = false;
		}
	 }
}

//=========================================
function Mascara_Processo(Processo)
{
	switch (Processo.value.length)

	{
		case 2:
			Processo.value += ".";
			break;
		case 8:
			Processo.value += "/";
			break;
	}
}

function somenteNumeros(num) {
        var er = /[^0-9,]/;
        er.lastIndex = 0;
        var campo = num;
        if (er.test(campo.value)) {
          campo.value = "";
       }
 }

//Função que abre uma página em Popup
function popupPage() {
<cfoutput>  //página chamada, seguida dos parâmetros número, unidade, grupo e item
var page = "itens_inspetores_controle_respostas_comentarios.cfm?numero=#ninsp#&unidade=#unid#&numgrupo=#ngrup#&numitem=#nitem#";
</cfoutput>
windowprops = "location=no,"
+ "scrollbars=yes,width=750,height=500,top=100,left=200,menubars=no,toolbars=no,resizable=yes";
window.open(page, "Popup", windowprops);
}
</script>

</head>
<!--- <body onLoad="proc_disc(); exibe(0)"> --->
<body onLoad="exibevalores(); proc_disc(); exibe(document.form1.frmResp.value); reincidencia(document.form1.frmReinccb.value); hanci()">
<!--- <cfinclude template="cabecalho.cfm"> --->
<table width="85%"  align="center">
  <tr>
    <td height="20" colspan="5"><div align="center"><strong class="titulo2"><cfoutput>#qResposta.Dir_Descricao#</cfoutput></strong></div></td>
  </tr>
  <tr>
    <td height="20" colspan="5">&nbsp;</td>
  </tr>
  <tr>
    <td height="10" colspan="5"><div align="center"><strong class="titulo1">Controle das MANIFESTA&Ccedil;&Otilde;ES</strong></div></td>
  </tr>
  <tr>
    <td height="20" colspan="5">&nbsp;</td>
  </tr>
  <form name="form1" method="post" onSubmit="return validarform()" enctype="multipart/form-data" action="itens_inspetores_controle_respostas1.cfm">
    <cfoutput>
	<input type="hidden" name="sfrmPosArea" id="sfrmPosArea" value="#qResposta.Pos_Area#">
	<input type="hidden" name="sfrmPosNomeArea" id="sfrmPosNomeArea" value="#qResposta.Pos_NomeArea#">
	<input type="hidden" name="sfrmTipoUnidade" id="sfrmTipoUnidade" value="#qResposta.Itn_TipoUnidade#">

	<cfset caracvlr = trim(qResposta.RIP_Caractvlr)>
	<cfset falta = #mid(LSCurrencyFormat(qResposta.RIP_Falta, "local"), 4, 16)#>
	<cfset sobra = #mid(LSCurrencyFormat(qResposta.RIP_Sobra, "local"), 4, 16)#>
	<cfset emrisco = #mid(LSCurrencyFormat(qResposta.RIP_EmRisco, "local"), 4, 16)#>
    <input type="hidden" name="sfrmfalta" id="sfrmfalta" value="#falta#">
	<input type="hidden" name="sfrmsobra" id="sfrmsobra" value="#sobra#">
	<input type="hidden" name="sfrmemrisco" id="sfrmemrisco" value="#emrisco#">
	<!--- <input type="hidden" name="db_RIPReincInspecao" id="db_RIPReincInspecao" value="#qResposta.RIP_ReincInspecao#"> --->
	</cfoutput>

    <tr>
      <td colspan="5"><p class="titulo1">
        <input type="hidden" id="acao" name="acao" value="">
        <input type="hidden" id="anexo" name="anexo" value="">
        <input type="hidden" id="vCausaProvavel" name="vCausaProvavel" value="">
        <input type="hidden" id="vCodigo" name="vCodigo" value="">
        <input name="unid" type="hidden" id="unid" value="<cfoutput>#URL.Unid#</cfoutput>">
        <input name="ninsp" type="hidden" id="ninsp" value="<cfoutput>#URL.Ninsp#</cfoutput>">
        <input name="ngrup" type="hidden" id="ngrup" value="<cfoutput>#URL.Ngrup#</cfoutput>">
        <input name="nitem" type="hidden" id="nitem" value="<cfoutput>#URL.Nitem#</cfoutput>">
        <input name="dtinicio" type="hidden" id="dtinicio" value="<cfoutput>#URL.DtInic#</cfoutput>">
        <input name="dtfinal" type="hidden" id="dtfinal" value="<cfoutput>#URL.dtfim#</cfoutput>">
        <input name="cktipo" type="hidden" id="cktipo" value="<cfoutput>#ckTipo#</cfoutput>">
        <input name="reop" type="hidden" id="reop" value="<cfoutput>#URL.reop#</cfoutput>">
        <input type="hidden" id="hUnidade" name="hUnidade" value="<cfoutput>#rsMOd.Und_Descricao#</cfoutput>">
        <input type="hidden" id="hReop" name="hReop" value="<cfoutput>#URL.reop#</cfoutput>">
        <input type="hidden" id="SE" name="SE" value="<cfoutput>#URL.SE#</cfoutput>">
		<input type="hidden" id="selstatus" name="selstatus" value="<cfoutput>#URL.selstatus#</cfoutput>">
        <input type="hidden" id="statusse" name="statusse" value="<cfoutput>#URL.statusse#</cfoutput>">
		<input type="hidden" id="vlrdeclarado" name="vlrdeclarado" value="<cfoutput>#rsvlrdec.Itn_ValorDeclarado#</cfoutput>">
		<input type="hidden" id="emailusu" name="emailusu" value="<cfoutput>#qAcesso.Usu_Email#</cfoutput>">
      </p></td>
    </tr>
	  <tr>
      <td width="95" bgcolor="f7f7f7" class="exibir">Unidade</td>
      <td width="320" bgcolor="f7f7f7"><div align="left"><cfoutput><strong class="exibir">#URL.Unid#</strong></cfoutput>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<cfoutput><strong class="exibir">#rsMOd.Und_Descricao#</strong></cfoutput></div></td>
      <td colspan="3" bgcolor="f7f7f7"><div align="left"><span class="exibir">Respons&aacute;vel</span>&nbsp;&nbsp;<cfoutput><strong class="exibir">#qResponsavel.INP_Responsavel#</strong></cfoutput></div></td>
      </tr>

        <tr class="exibir">
            <cfif qInspetor.RecordCount lt 2>
              <td bgcolor="eeeeee">Inspetor</td>
              <cfelse>
              <td bgcolor="eeeeee">Inspetores</td>
            </cfif>
            <cfset Num_Insp = Left(URL.Ninsp,2) & '.' & Mid(URL.Ninsp,3,4) & '/' & Right(URL.Ninsp,4)>
            <td colspan="4" bgcolor="f7f7f7">-&nbsp;<cfoutput query="qInspetor"><strong class="exibir">#qInspetor.Fun_Nome#</strong>&nbsp;<cfif qInspetor.currentrow neq qInspetor.recordcount><br>-&nbsp;</cfif></cfoutput></td>
      </tr>

      </tr>
      <tr class="exibir">
      <td bgcolor="f7f7f7">Nº Relatório</td>
      <td colspan="4" bgcolor="f7f7f7"><cfoutput><strong class="exibir">#URL.Ninsp#</strong></cfoutput>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;In&iacute;cio Inspe&ccedil;&atilde;o <cfoutput><strong class="exibir">#DateFormat(qResposta.INP_DtInicInspecao,"dd/mm/yyyy")#</strong></cfoutput></td>
      </tr>
    <tr class="exibir">
      <td bgcolor="f7f7f7">Grupo</td>
      <td colspan="4" bgcolor="f7f7f7"><cfoutput><strong class="exibir">#URL.Ngrup#</strong></cfoutput>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<cfoutput><strong class="exibir">#URL.DGrup#</strong></cfoutput></td>
    </tr>
    <tr class="exibir">
      <td bgcolor="f7f7f7">Item</td>
      <td colspan="4" bgcolor="f7f7f7"><cfoutput><strong class="exibir">#URL.Nitem#</strong></cfoutput>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<cfoutput><strong class="exibir">#qResposta.Itn_Descricao#</strong></cfoutput></td>
    </tr>
	<tr class="exibir">
<td bgcolor="f7f7f7">Valor</td>
      <td colspan="4" bgcolor="f7f7f7"><cfoutput><strong>#qResposta.RIP_Valor#</strong></cfoutput></td>
    </tr>
	<cfoutput>
		
	<tr class="exibir">
		<td bgcolor="f7f7f7">Reincid&ecirc;ncia</td>
		<td colspan="4" bgcolor="f7f7f7">
		<cfif len(trim(qResposta.RIP_ReincInspecao)) neq 10>
		   <cfset reincSN = "N">
		   <cfset db_reincInsp = "">
		   <cfset db_reincGrup = 0>
		   <cfset db_reincItem = 0>
		 <cfelse>
		   <cfset reincSN = "S">
		   <cfset db_reincInsp = #trim(qResposta.RIP_ReincInspecao)#>
		   <cfset db_reincGrup = #qResposta.RIP_ReincGrupo#>
		   <cfset db_reincItem = #qResposta.RIP_ReincItem#>
		 </cfif>
			
			<input type="hidden" name="dbreincInsp" id="dbreincInsp" value="<cfoutput>#db_reincInsp#</cfoutput>">
			<input type="hidden" name="dbreincGrup" id="dbreincGrup" value="<cfoutput>#db_reincGrup#</cfoutput>">
			<input type="hidden" name="dbreincItem" id="dbreincItem" value="<cfoutput>#db_reincItem#</cfoutput>">
	<cfif (qResposta.Pos_Situacao_Resp is 0) or (qResposta.Pos_Situacao_Resp is 11)>
		    <input type="hidden" name="db_reincSN" id="db_reincSN" value="S">
			<select name="frmReinccb" class="form" id="frmReinccb" onChange="reincidencia(this.value)">
			  <option value="N" <cfif #reincSN# is "N">selected</cfif>>Não</option>
			  <option value="S" <cfif #reincSN# is "S">selected</cfif>>Sim</option>
			</select>	
  
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Nº Relatório:
			<input name="frmreincInsp" type="text" class="form" id="frmreincInsp" size="16" maxlength="10" value="#db_reincInsp#" onKeyPress="numericos(this.value)">
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Nº Grupo: 
			<input name="frmreincGrup" type="text" class="form" id="frmreincGrup" size="8" maxlength="5" value="#db_reincGrup#" onKeyPress="numericos(this.value)">
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Nº Item: 
			<input name="frmreincItem" type="text" class="form" id="frmreincItem" size="7" maxlength="4" value="#db_reincItem#" onKeyPress="numericos(this.value)">
			</strong>
		  </td>
	</tr>
	 <tr class="exibir">
      <td bgcolor="f7f7f7">Valores</td>
      <td colspan="4" bgcolor="f7f7f7">Caracteres:
        <select name="caracvlr" id="caracvlr" class="form" onChange="exibevalores()">
	      <option <cfif trim(caracvlr) eq "Quantificado"> selected</cfif> value="Quantificado">Quantificado</option>
          <option <cfif trim(caracvlr) eq "Não Quantificado"> selected</cfif> value="Não Quantificado">Não Quantificado</option>
        </select>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Falta(R$):
        <input name="frmfalta" type="text" class="form" onKeyPress="moedas(this.value,'frmfalta')" onKeyDown="validacao()" value="#falta#" size="22" maxlength="16" onDblClick="exibirMoeda(this.value,<cfoutput>'#falta#'</cfoutput>,'frmfalta','DC')" onChange="exibirMoeda(this.value,<cfoutput>'#falta#'</cfoutput>,'frmfalta','0')">
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Sobra(R$):
        <input name="frmsobra" type="text" class="form" onKeyPress="moedas(this.value,'frmsobra')" onKeyDown="validacao()" value="#sobra#" size="22" maxlength="16" onDblClick="exibirMoeda(this.value,<cfoutput>'#sobra#'</cfoutput>,'frmsobra','DC')" onChange="exibirMoeda(this.value,<cfoutput>'#sobra#'</cfoutput>,'frmsobra','0')">
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Em Risco(R$):
        <input name="frmemrisco" type="text" class="form" onKeyPress="moedas(this.value,'frmemrisco')" onKeyDown="validacao()" value="#emrisco#" size="22" maxlength="16" onDblClick="exibirMoeda(this.value,<cfoutput>'#emrisco#'</cfoutput>,'frmemrisco','DC')" onChange="exibirMoeda(this.value,<cfoutput>'#emrisco#'</cfoutput>,'frmemrisco','0')">
	  </td>
      </tr>
      
     <cfelse>
		        <input type="hidden" name="db_reincSN" id="db_reincSN" value="N">
				<input name="caracvlr" class="form" type="text" value="#reincSN#" readonly="yes">
	  
				&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Nº Relatório:
				<input name="frmreincInsp" type="text" class="form" id="frmreincInsp" size="16" maxlength="10" value="#db_reincInsp#" readonly="yes">
				&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Nº Grupo: 
				<input name="frmreincGrup" type="text" class="form" id="frmreincGrup" size="8" maxlength="5" value="#db_reincGrup#" readonly="yes">
				&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Nº Item: 
				<input name="frmreincItem" type="text" class="form" id="frmreincItem" size="7" maxlength="4" value="#db_reincItem#" readonly="yes">
				</strong>
			  </td>
		  </tr>
		  <tr class="exibir">
		  <td bgcolor="f7f7f7">Valores</td>
		  <td colspan="4" bgcolor="f7f7f7">Caracteres: <input name="caracvlr" class="form" type="text" value="#caracvlr#" readonly="yes">
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Falta(R$):
			<input name="frmfalta" type="text" class="form" value="#falta#" size="22" maxlength="16" readonly="yes">
			  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;Sobra(R$):
			  <input name="frmsobra" type="text" class="form" value="#sobra#" size="22" maxlength="16" readonly="yes">
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Em Risco(R$):
			<input name="frmemrisco" type="text" class="form" value="#emrisco#" size="22" maxlength="16" readonly="yes">
		  
    </cfif>
    </tr> 
	</cfoutput>
    <cfif (qResposta.Pos_Situacao_Resp is 0) or (qResposta.Pos_Situacao_Resp is 11)>
       <tr>
         <td bgcolor="#eeeeee" align="center"><span class="titulos">Oportunidade de Aprimoramento:</span></td>
        <td colspan="5" bgcolor="f7f7f7"><textarea name="Melhoria" cols="200" rows="20" wrap="VIRTUAL" class="form"><cfoutput>#qResposta.RIP_Comentario#</cfoutput></textarea></td>
        </tr>
		<cfelse>

		<tr>
         <td bgcolor="#eeeeee" align="center"><span class="titulos">Oportunidade de Aprimoramento:</span></td>
        <td colspan="5" bgcolor="f7f7f7"><textarea name="Melhoria" cols="200" rows="20" wrap="VIRTUAL" class="form" readonly><cfoutput>#qResposta.RIP_Comentario#</cfoutput></textarea></td>
      </tr>

	  </cfif>
      <cfif (qResposta.Pos_Situacao_Resp is 0) or (qResposta.Pos_Situacao_Resp is 11)>
        <td bgcolor="eeeeee" align="center"><span class="titulos">Orientações:</span></td>
        <td colspan="5" bgcolor="f7f7f7"><textarea name="recomendacao" cols="200" rows="12" wrap="VIRTUAL" class="form"><cfoutput>#qResposta.RIP_Recomendacoes#</cfoutput></textarea></td>
    </tr>
    <tr>
      <td colspan="5">&nbsp;</td>
    </tr>
    <tr>
      <td colspan="5" class="exibir" bgcolor="eeeeee"><div align="left"><strong>ANEXOS</strong></div></td>
    </tr>
<!---     <tr>
      <td colspan="5">&nbsp;</td>
    </tr> --->
	<tr>
        <td bgcolor="eeeeee" class="exibir"><strong>Arquivo:</strong></td>
        <td bgcolor="eeeeee" class="exibir"><input name="arquivo" class="botao" type="file" size="50"></td>
        <td bgcolor="eeeeee" class="exibir">&nbsp;</td>
        <td bgcolor="eeeeee" class="exibir"><input name="submit" type="submit" class="botao" onClick="document.form1.acao.value='Anexar'" value="Anexar"></td>
        <td width="98" bgcolor="eeeeee" class="exibir">&nbsp;</td>
      </tr>
      <tr>
        <td colspan="5">&nbsp;</td>
      </tr>
    <cfloop query= "qAnexos">
      <cfif FileExists(qAnexos.Ane_Caminho)>
        <tr>
          <td colspan="3" bgcolor="#eeeeee" class="form"><cfoutput>#ListLast(qAnexos.Ane_Caminho,'\')#</cfoutput></td>
          <td width="348" bgcolor="#eeeeee"><cfset arquivo = ListLast(qAnexos.Ane_Caminho,'\')>
                  <div align="left">
                    &nbsp;
                    <input type="button" class="botao" name="Abrir" value="Abrir" onClick="window.open('abrir_pdf_act.cfm?arquivo=<cfoutput>#arquivo#</cfoutput>','_blank')" />
                </div></td>
		  <td bgcolor="eeeeee"><cfoutput>
              <div align="center">
                <input name="submit" type="submit" class="botao" onClick="document.form1.acao.value='Excluir_Anexo';document.form1.vCodigo.value=this.codigo" value="Excluir" codigo="#qAnexos.Ane_Codigo#">
		        </div>
		  </cfoutput></td>
        </tr>
      </cfif>
    </cfloop>
	<tr>
      <td colspan="5">&nbsp;</td>
    </tr>
<!--- 	<cfif (qResposta.Pos_Situacao_Resp is 0) or (qResposta.Pos_Situacao_Resp is 11)>
	<tr>
	<td colspan="6" bgcolor="eeeeee" class="exibir"><div align="left">Selecione a &aacute;rea:
	      <select name="frmcbarea" id="frmcbarea" class="form">
                  <option value="">---</option>
                  <cfoutput query="qArea">
                      <option value="#Ars_Codigo#">#trim(Ars_Sigla)#</option>
                  </cfoutput>
            </select>
    </div></td>
	</tr>
	</cfif> --->
    <tr>
      <td colspan="5" align="center"><cfoutput>
        <input name="button" type="button" class="botao" onClick="window.open('itens_inspetores_controle_respostas.cfm?ninsp=#URL.Ninsp#&unid=#URL.Unid#&ngrup=#URL.Ngrup#&nitem=#URL.Nitem#&dtfim=#url.dtfim#&dtinic=#url.dtinic#&SE=#url.SE#&cktipo=#url.cktipo#&selstatus=#selstatus#&StatusSE=#StatusSE#','_self')" value="Voltar">
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<input name="Submit" type="Submit" class="botao" value="Salvar" onClick="document.form1.acao.value='Salvar';">
</cfoutput></td>
    </tr>
			<script>
			   reincidencia(document.form1.frmReinccb.value)
			</script>
    <cfabort>
  <cfelse>
    <tr>
      <td bgcolor="eeeeee" align="center"><span class="titulos">Orientações:</span></td>
      <td colspan="5" bgcolor="eeeeee"><textarea name="recomendacao" cols="200" rows="12" wrap="VIRTUAL" class="form" readonly><cfoutput>#qResposta.RIP_Recomendacoes#</cfoutput></textarea></td>
    </tr></cfif>
   <!---  <input type="hidden" name="obs" value="<cfoutput>#qResposta.Pos_Parecer#</cfoutput>"> --->
    <tr>
      <td valign="middle" bgcolor="eeeeee" align="center"><p><span class="titulos">Hist&oacute;rico:</span> <span class="titulos">Manifestação e Plano de Ação/An&aacute;lise do Controle Interno</span><span class="titulos">:</span></p>
        <p>
          <input name="extrato" type="button" class="botao" id="extrato" onClick="window.open('Exibir_Texto_Parecer.cfm?frmUnid=<cfoutput>#unid#</cfoutput>&frmNumInsp=<cfoutput>#ninsp#</cfoutput>&frmGrupo=<cfoutput>#ngrup#</cfoutput>&frmItem=<cfoutput>#nitem#</cfoutput>','_blank')" value="+ Detalhes" />
        </td>
      <td colspan="5" bgcolor="eeeeee"><textarea name="H_obs" cols="200" value="#Session.E01.h_obs#" rows="40" wrap="VIRTUAL" class="form" readonly><cfoutput>#qResposta.Pos_parecer#</cfoutput></textarea></td>
    </tr>
    <tr bgcolor="f7f7f7">
      <td bgcolor="eeeeee" align="center"><span class="titulos">Causas Prováveis:</span></td>
      <td colspan="3" valign="middle" bgcolor="eeeeee" class="exibir">
	  <select name="causaprovavel" class="form">
        <option selected="selected" value="">---</option>
        <cfoutput query="qCausa">
          <option value="#Cpr_Codigo#">#Cpr_Descricao#</option>
        </cfoutput>
      </select></td>
      <td bgcolor="eeeeee"><input name="btn_inc_causa" id="btn_inc_causa" type="Submit" class="botao" value="Incluir" onClick="document.form1.acao.value='Incluir_Causa';"></td>
    </tr>
    <cfoutput query="qCausaProcesso">
      <tr bgcolor="f7f7f7">
        <td bgcolor="eeeeee">&nbsp;</td>
        <td colspan="3" bgcolor="eeeeee" valign="middle" class="exibir"> #Cpr_Descricao# </td>
		<!--- <cfif qCausaProcesso.recordcount gt 1> --->
        <td bgcolor="eeeeee"><input name="btn_ExcluirCausa" id="btn_ExcluirCausa" type="submit" class="botao" onClick="document.form1.acao.value='Excluir_Causa';document.form1.vCausaProvavel.value=#qCausaProcesso.Cpr_Codigo#" value="Excluir" codigo="#qCausaProcesso.Cpr_Codigo#"></td>
		<!--- <cfelse>
		<td bgcolor="eeeeee"><input name="btn_ExcluirCausa" id="btn_ExcluirCausa" type="submit" class="botao" onClick="document.form1.acao.value='Excluir_Causa';document.form1.vCausaProvavel.value=#qCausaProcesso.Cpr_Codigo#" value="Excluir_Causa" codigo="#qCausaProcesso.Cpr_Codigo#" disabled></td>
		</cfif> --->
      </tr>
    </cfoutput>
	<cfif qCausaProcesso.recordcount gt 0>
	 <cfset aux_causa = "S">
	<cfelse>
	 <cfset aux_causa = "N">
	</cfif>
	<input type="hidden" name="causasprovSN" id="causasprovSN" value="<cfoutput>#aux_causa#</cfoutput>">
    <tr>
      <td colspan="5">&nbsp;</td>
    </tr>
     <!--- Se existir dados na sessão, exibir os dados armazenados --->
    <cfif isDefined("Session.E01.abertura")>
	   <tr bgcolor="f7f7f7">
        <td colspan="5">
		<table width="100%" border="0">

          <tr bgcolor="f7f7f7">
				<td valign="middle" bgcolor="eeeeee" class="exibir">Foi aberto processo disciplinar?&nbsp;&nbsp;
				<select name="abertura" class="form"  onchange="proc_disc()">
				<option value="Não" <cfif Session.E01.abertura is 'Não' or Session.E01.abertura is ''>selected</cfif>>Não</option>
				<option value="Sim" <cfif Session.E01.abertura is 'Sim'>selected</cfif>>Sim</option>
				</select>
				</td>
				<td width="75%" colspan="-3" bgcolor="eeeeee"><div id="dproc">
				 <!--- Se existir dados na sessão, exibir os dados armazenados --->
					<cfset proc = trim(Session.E01.processo)>
					  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="exibir">Nº Processo:</span>&nbsp;&nbsp;
					  <!--- <input name="proc_se" type="text" class="form" value="<cfoutput>#Left(proc,2)#</cfoutput>" size="1" maxlength="2" readonly="yes">-<input name="proc_num" type="text" class="form" value="<cfoutput>#Mid(proc,3,5)#</cfoutput>" onKeyPress="numericos()" onKeyDown="Mascara_Data(this)" size="6" maxlength="5">-<input name="proc_ano" type="text" class="form" onKeyPress="numericos()" onKeyDown="Mascara_Data(this)" value="<cfoutput>#Right(proc,2)#</cfoutput>" size="1" maxlength="2"> --->
					  <input name="proc_se" type="text" class="form" value="<cfoutput>#Left(proc,2)#</cfoutput>" onKeyPress="numericos()" size="2" maxlength="2">-<input name="proc_num" type="text" class="form" value="<cfoutput>#Mid(proc,3,5)#</cfoutput>" onKeyPress="numericos()"  size="6" maxlength="5">-<input name="proc_ano" type="text" class="form" onKeyPress="numericos()" value="<cfoutput>#Right(proc,2)#</cfoutput>" size="2" maxlength="2">
					  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
					  <span class="exibir">Modalidade:&nbsp;</span>&nbsp;
					  <select name="modalidade" class="form">
						<option <cfif trim(Session.E01.modalidade) eq ""> selected</cfif> value="">---</option>
						<option <cfif trim(Session.E01.modalidade) eq "TAC"> selected</cfif> value="TAC">TAC</option>
						<option <cfif trim(Session.E01.modalidade) eq "Apuracao_Direta"> selected</cfif> value="Apuracao_Direta">Apuração Direta</option>
						<option <cfif trim(Session.E01.modalidade) eq "Sindicancia_Sumaria"> selected</cfif> value="Sindicancia_Sumaria">Sindicância Sumária</option>
					  </select>
				</div>
				</td>
          </tr>
		  <tr>
            <td colspan="5">&nbsp;</td>
            </tr>
        </table>
		</td>
      </tr>

       <tr bgcolor="f7f7f7">
        <td height="22" colspan="2" valign="middle" bgcolor="eeeeee" class="exibir">Situa&ccedil;&atilde;o:&nbsp;&nbsp;
            <label><span class="style4">
            <select name="frmResp" class="form" id="frmResp" onChange="exibe(this.value)">
			 <option selected="selected" value="N">---</option>
              <cfoutput query="rsPonto">
			    <cfif STO_Codigo neq 0 and STO_Codigo neq 1>
                 <option value="#STO_Codigo#" <cfif #STO_Codigo# is #qResposta.Pos_Situacao_Resp#>selected</cfif>>#trim(STO_Descricao)#</option> 
				<!---<option value="#STO_Codigo#">#trim(STO_Descricao)#</option>--->
				</cfif>
              </cfoutput>
            </select>
          </label></td>
		    <cfif trim(qResposta.Pos_SEI) eq "">
		    <cfset numsei = "">
		  <cfelse>
		    <cfset numsei = trim(qResposta.Pos_SEI)>
			<cfset numsei = left(numsei,5) & '.' & mid(numsei,6,6) & '/' & mid(numsei,12,4) & '-' & right(numsei,2)>
		  </cfif>
        <td colspan="3" valign="middle" bgcolor="eeeeee" class="exibir">Nº SEI da Apuração :&nbsp;&nbsp;
<input name="frmnumsei" id="frmnumsei" type="text" class="form" onKeyPress="numericos()" onKeyDown="validacao(),Mascara_SEI(this)" size="27" maxlength="20" value="<cfoutput>#numsei#</cfoutput>"></td>
        </tr>
		<tr bgcolor="eeeeee">
        <td height="22" colspan="2" bgcolor="eeeeee" class="exibir"><div id="dArea">Selecione a &aacute;rea:
            <select name="cbArea" id="cbArea" class="form">
                  <option selected="selected" value="">---</option>
                  <cfoutput query="qArea">
                    <option value="#Ars_Codigo#" <cfif #Ars_Codigo# is #qResposta.Pos_Area#>selected</cfif>>#trim(Ars_Sigla)#</option>
                  </cfoutput>
              </select>
        </div>
		</td>

   <!---   <cfif qVerificaPonto.RecordCount Neq 0> --->

       <cfif trim(qResposta.Pos_VLRecuperado) eq ''>
	      <cfset vlrrecaux = "0,00">
       <cfelse>
	     <cfset vlrrecaux = #mid(LSCurrencyFormat(qResposta.Pos_VLRecuperado, "local"), 4, 16)#>
       </cfif>
	   <td colspan="3" bgcolor="eeeeee" class="exibir"><div id="dValor">Valor Regularizado(R$):&nbsp;&nbsp;
         <input name="VLRecuperado" type="text" class="form" onKeyPress="moedas(this.value,'VLRecuperado')" onKeyDown="validacao()" value="<cfoutput>#vlrrecaux#</cfoutput>" size="22" maxlength="16" onDblClick="exibirMoeda(this.value,<cfoutput>'#vlrrecaux#'</cfoutput>,'VLRecuperado','DC')" onChange="exibirMoeda(this.value,<cfoutput>'#vlrrecaux#'</cfoutput>,'VLRecuperado','0')">
	  </td>
      </tr>
        <tr bgcolor="f7f7f7">
          <td colspan="5" bgcolor="eeeeee" class="exibir"><div id="dAreaCS">Selecione a &aacute;rea:
            <select name="cbAreaCS" class="form">
              <option selected="selected" value="">---</option>
              <cfoutput query="qAreaCS">
				<option value="#Ars_Codigo#" <cfif #Ars_Codigo# is #qResposta.Pos_Area#>selected</cfif>>#trim(Ars_Sigla)#</option>
              </cfoutput>
            </select>
        </div></td>
        </tr>

      <tr>
        <td colspan="5">&nbsp;</td>
      </tr>
      <tr>
        <td bgcolor="eeeeee" align="center"><span class="titulos">Opini&atilde;o da Equipe de Controle Interno:</span></td>
        <td colspan="5" bgcolor="f7f7f7"><textarea name="observacao" cols="200" rows="25" nome="Observacao" vazio="false" wrap="VIRTUAL" class="form" id="observacao"><cfoutput>#Session.E01.observacao#</cfoutput></textarea></td>
      </tr>
      <tr>
        <td colspan="3" class="exibir" bgcolor="eeeeee"><strong>ANEXOS</strong></td>
        <td colspan="2" bgcolor="eeeeee" class="exibir"></td>
      </tr>
      <tr bgcolor="eeeeee">
        <td class="exibir"><strong>Arquivo:</strong></td>
        <td class="exibir"><input name="arquivo" class="botao" type="file" size="50"></td>
        <td width="242" class="exibir">&nbsp;</td>
        <td class="exibir"><input name="submit" type="submit" class="botao" onClick="document.form1.acao.value='Anexar'" value="Anexar"></td>
        <td class="exibir">&nbsp;</td>
      </tr>
      <tr>
        <td colspan="5">&nbsp;</td>
      </tr>
      <cfloop query= "qAnexos">
        <cfif FileExists(qAnexos.Ane_Caminho)>
          <tr>
            <td colspan="3" bgcolor="eeeeee" class="form"><cfoutput>#ListLast(qAnexos.Ane_Caminho,'\')#</cfoutput></td>
            <td width="348" align="center" bgcolor="eeeeee"><cfset arquivo = ListLast(qAnexos.Ane_Caminho,'\')>
                <div align="left">
                  &nbsp;
                  <input type="button" class="botao" name="Abrir" value="Abrir" onClick="window.open('abrir_pdf_act.cfm?arquivo=<cfoutput>#arquivo#</cfoutput>','_blank')" />
                </div></td>
            <td bgcolor="eeeeee"><cfoutput>
              <div align="center">
                <input name="submit" type="submit" class="botao" onClick="document.form1.acao.value='Excluir_Anexo';document.form1.vCodigo.value=this.codigo" value="Excluir" codigo="#qAnexos.Ane_Codigo#">
              </div>
            </cfoutput></td>
          </tr>
        </cfif>
      </cfloop>
      <tr>
        <td colspan="5">&nbsp;</td>
      </tr>

     <cfelse>
	  <tr>
        <td colspan="5">
			<table width="100%" border="0">
  		     <cfif trim(qResposta.Pos_NCISEI) eq ''>
				<cfset numncisei = "">            
			   <tr bgcolor="f7f7f7">
				<td colspan="5" valign="middle" bgcolor="eeeeee" class="exibir">Houve Nota de Controle?&nbsp;&nbsp;
				<select name="nci" class="form"  onchange="hanci()">
				<option value="Não" selected>Não</option>
				<option value="Sim">Sim</option>
				</select>
				</td>
				<cfset aux_ano = right(dateformat(now(),"YYYY"),2)>
				<td width="77%" bgcolor="eeeeee" class="exibir"><div id="ncisei">Nº SEI da NCI :&nbsp;&nbsp;
                   <input name="frmnumseinci" id="frmnumseinci" type="text" class="form" onKeyPress="numericos()" onKeyDown="validacao(),Mascara_SEI(this)" size="27" maxlength="20" value="<cfoutput>#numncisei#</cfoutput>">
				  </div>
				  </td>
				  </tr>
             <cfelse>
			   <cfset numncisei = trim(qResposta.Pos_NCISEI)>
				<cfset numncisei = left(numncisei,5) & '.' & mid(numncisei,6,6) & '/' & mid(numncisei,12,4) & '-' & right(numncisei,2)>
				  <tr bgcolor="f7f7f7">
				   <td colspan="5" valign="middle" bgcolor="eeeeee" class="exibir">Houve Nota de Controle?&nbsp;&nbsp;
				<select name="nci" class="form"  onchange="hanci()">
				<option value="Não">Não</option>
				<option value="Sim" selected>Sim</option>
				</select>
				</td>
				 <td width="77%" bgcolor="eeeeee" class="exibir"><div id="ncisei">Nº SEI da NCI :&nbsp;&nbsp;
                   <input name="frmnumseinci" id="frmnumseinci" type="text" class="form" onKeyPress="numericos()" onKeyDown="validacao(),Mascara_SEI(this)" size="27" maxlength="20" value="<cfoutput>#numncisei#</cfoutput>">
				  
				  </div>
				  </td>
				  </tr>
           </cfif>
        </table>
		<table width="100%" border="0">

		  <cfif trim(qResposta.Pos_Processo) eq ''>

		   <tr bgcolor="f7f7f7">
            <td valign="middle" bgcolor="eeeeee" class="exibir">Foi aberto processo disciplinar?&nbsp;&nbsp;
            <select name="abertura" class="form"  onchange="proc_disc()">
			<option value="Não" selected>Não</option>
			<option value="Sim">Sim</option>
            </select>
			</td>
			<cfset aux_ano = right(dateformat(now(),"YYYY"),2)>
            <td width="77%" colspan="-3" bgcolor="eeeeee"><div id="dproc">
              &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="exibir">Nº Processo:</span>&nbsp;&nbsp;
              <!--- <input name="proc_se" type="text" class="form" value="<cfoutput>#qUsuario.Usu_DR#</cfoutput>" size="1" maxlength="2" readonly="yes">-<input name="proc_num" type="text" class="form" onKeyPress="numericos()" onKeyDown="Mascara_Data(this)" size="6" maxlength="5">-<input name="proc_ano" type="text" class="form" onKeyPress="numericos()" onKeyDown="Mascara_Data(this)" value="<cfoutput>#aux_ano#</cfoutput>" size="1" maxlength="2">
              &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; --->
			   <input name="proc_se" type="text" class="form" value="<cfoutput>#SE#</cfoutput>" onKeyPress="numericos()" size="2" maxlength="2">-<input name="proc_num" type="text" class="form" onKeyPress="numericos()" size="6" maxlength="5">-<input name="proc_ano" type="text" class="form" onKeyPress="numericos()"  value="<cfoutput>#aux_ano#</cfoutput>" size="2" maxlength="2">
              &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
              <span class="exibir">Modalidade:&nbsp;</span>&nbsp;
              <select name="modalidade" class="form">
                <option value="">---</option>
				<option value="TAC">TAC</option>
                <option value="Apuracao_Direta">Apuração Direta</option>
                <option value="Sindicancia_Sumaria">Sindicância Sumária</option>
              </select>
  			  </td>
			  </tr>
              <cfelse>
			  <tr bgcolor="f7f7f7">
			   <td valign="middle" bgcolor="eeeeee" class="exibir">Foi aberto processo disciplinar?&nbsp;&nbsp;
            <select name="abertura" class="form"  onchange="proc_disc()">
			<option <cfif trim(qResposta.Pos_Abertura) eq "Não" or trim(qResposta.Pos_Abertura) eq ""> selected</cfif> value="Não">Não</option>
			<option <cfif trim(qResposta.Pos_Abertura) eq "Sim"> selected</cfif> value="Sim">Sim</option>
            </select>
			</td>
			 <td width="77%" colspan="-3" bgcolor="eeeeee"><div id="dproc">
              <cfset proc = trim(qResposta.Pos_Processo)>
              &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="exibir">Nº Processo:</span>&nbsp;&nbsp;
			  <!--- <input name="proc_se" type="text" class="form" value="<cfoutput>#Left(proc,2)#</cfoutput>" size="1" maxlength="2" readonly="yes">-<input name="proc_num" type="text" class="form" value="<cfoutput>#Mid(proc,3,5)#</cfoutput>" onKeyPress="numericos()" onKeyDown="Mascara_Data(this)" size="6" maxlength="5">-<input name="proc_ano" type="text" class="form" onKeyPress="numericos()" onKeyDown="Mascara_Data(this)" value="<cfoutput>#Right(proc,2)#</cfoutput>" size="1" maxlength="2">
              &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; --->
			  <input name="proc_se" type="text" class="form" value="<cfoutput>#Left(proc,2)#</cfoutput>" onKeyPress="numericos()" size="2" maxlength="2">-<input name="proc_num" type="text" class="form" value="<cfoutput>#Mid(proc,3,5)#</cfoutput>" onKeyPress="numericos()" size="6" maxlength="5">-<input name="proc_ano" type="text" class="form" onKeyPress="numericos()" value="<cfoutput>#Right(proc,2)#</cfoutput>" size="2" maxlength="2">
              &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
              <span class="exibir">Modalidade:&nbsp;</span>&nbsp;
              <select name="modalidade" class="form">
                <option <cfif trim(qResposta.Pos_Tipo_Processo) eq ""> selected</cfif> value="">---</option>
				<option <cfif trim(qResposta.Pos_Tipo_Processo) eq "TAC"> selected</cfif> value="TAC">TAC</option>
                <option <cfif trim(qResposta.Pos_Tipo_Processo) eq "Apuracao_Direta"> selected</cfif> value="Apuracao_Direta">Apuração Direta</option>
                <option <cfif trim(qResposta.Pos_Tipo_Processo) eq "Sindicancia_Sumaria"> selected</cfif> value="Sindicancia_Sumaria">Sindicância Sumária</option>
              </select>
			  </div>
			  </td>
			  </tr>
			  <tr>
		     <td colspan="2" valign="middle" class="exibir">&nbsp;</td>
		     </tr>
            </cfif>
        </table>
		</td>
      </tr>
<!---       <tr bgcolor="f7f7f7">
        <td height="22" colspan="5" valign="middle" class="exibir">&nbsp;</td>
        </tr> --->
      <tr bgcolor="f7f7f7">
        <td height="22" colspan="2" valign="middle" bgcolor="eeeeee" class="exibir">Situa&ccedil;&atilde;o:&nbsp;&nbsp;
              <select name="frmResp" class="form" id="frmResp" onChange="exibe(this.value)">
			  <option selected="selected" value="N">---</option>
              <cfoutput query="rsPonto">
                <cfif STO_Codigo neq 0 and STO_Codigo neq 1>
               <option value="#STO_Codigo#" <cfif #STO_Codigo# is #qResposta.Pos_Situacao_Resp#>selected</cfif>>#trim(STO_Descricao)#</option>
				 <!--- <option value="#STO_Codigo#">#trim(STO_Descricao)#</option> --->
				</cfif>
              </cfoutput>
            </select>
          </td>
		  <cfif trim(qResposta.Pos_SEI) eq "">
		    <cfset numsei = "">
		  <cfelse>
		    <cfset numsei = trim(qResposta.Pos_SEI)>
			<cfset numsei = left(numsei,5) & '.' & mid(numsei,6,6) & '/' & mid(numsei,12,4) & '-' & right(numsei,2)>
		  </cfif>
        <td colspan="3" valign="middle" bgcolor="eeeeee" class="exibir">Nº SEI da Apuração :&nbsp;&nbsp;
<input name="frmnumsei" id="frmnumsei" type="text" class="form" onKeyPress="numericos()" onKeyDown="validacao(),Mascara_SEI(this)" size="27" maxlength="20" value="<cfoutput>#numsei#</cfoutput>"></td>
        </tr>

	<!--- Verificar se o ponto tem valor declarado --->

	    <cfquery datasource="#dsn_inspecao#" name="qVerificaPonto">
			SELECT Itn_ValorDeclarado FROM Itens_Verificacao
			WHERE Itn_NumGrupo = #url.ngrup#  AND Itn_NumItem = #url.nitem# AND Itn_ValorDeclarado = 'S'
	    </cfquery>

	    <!--- <cfdump var="#qVerificaPonto#"> --->



<tr bgcolor="eeeeee">
        <td height="22" colspan="2" bgcolor="eeeeee" class="exibir"><div id="dArea">Selecione a &aacute;rea:
            <select name="cbArea" id="cbArea" class="form">
                  <option selected="selected" value="">---</option>
                  <cfoutput query="qArea">
                    <option value="#Ars_Codigo#" <cfif #Ars_Codigo# is #qResposta.Pos_Area#>selected</cfif>>#trim(Ars_Sigla)#</option>
                  </cfoutput>
              </select>
        </div></td>

       <cfif trim(qResposta.Pos_VLRecuperado) eq ''>
	      <cfset vlrrecaux = "0,00">
       <cfelse>
	    <cfset vlrrecaux = #mid(LSCurrencyFormat(qResposta.Pos_VLRecuperado, "local"), 4, 16)#>
       </cfif>
		<!--- <cfif qVerificaPonto.RecordCount Neq 0> --->
			   <td colspan="3" bgcolor="eeeeee" class="exibir"><div id="dValor">Valor Regularizado(R$):&nbsp;&nbsp;
				 <input name="VLRecuperado" type="text" class="form" onKeyPress="moedas(this.value,'VLRecuperado')" onKeyDown="validacao()" value="<cfoutput>#vlrrecaux#</cfoutput>" size="22" maxlength="16" onDblClick="exibirMoeda(this.value,<cfoutput>'#vlrrecaux#'</cfoutput>,'VLRecuperado','DC')" onChange="exibirMoeda(this.value,<cfoutput>'#vlrrecaux#'</cfoutput>,'VLRecuperado','0')">
			  </td>
<!--- 		 <cfelse>
				  <td colspan="3" bgcolor="eeeeee" class="exibir"><div id="dValor">Valor Regularizado(R$):&nbsp;&nbsp;
					 <input name="VLRecuperado" value="<cfoutput>#vlrrecaux#</cfoutput>" class="form" type="text" size="20" onKeyPress="numericos(VLRecuperado.value)"></div>
				  </td>
		 </cfif> --->
      </tr>

      <tr bgcolor="eeeeee">
        <td colspan="5" class="exibir"><div id="dAreaCS">Selecione a &aacute;rea:
            <select name="cbAreaCS" class="form">
              <option selected="selected" value="">---</option>
              <cfoutput query="qAreaCS">
				<option value="#Ars_Codigo#" <cfif #Ars_Codigo# is #qResposta.Pos_Area#>selected</cfif>>#trim(Ars_Sigla)#</option>
              </cfoutput>
            </select>
        </div></td>
        <!---         <td colspan="2" class="exibir">&nbsp;</td>
        <td colspan="2" class="exibir">&nbsp;</td> --->
      </tr>
      <tr>
        <td colspan="5">&nbsp;</td>
      </tr>
      <tr>
        <td bgcolor="eeeeee" align="center"><span class="titulos">Opini&atilde;o da Equipe de Controle Interno:</span></td>
        <td colspan="5" bgcolor="f7f7f7"><textarea name="observacao" cols="200" rows="25" nome="Observacao" vazio="false" wrap="VIRTUAL" class="form" id="observacao"></textarea></td>
      </tr>
      <tr>
        <td colspan="5">&nbsp;</td>
      </tr>
      <tr bgcolor="#eeeeee">
        <td colspan="5" bgcolor="eeeeee" class="exibir"><strong>ANEXOS</strong></td>
        </tr>
      <tr>
        <td bgcolor="eeeeee" class="exibir"><strong>Arquivo:</strong></td>
        <td colspan="2" bgcolor="eeeeee" class="exibir"><input name="arquivo" class="botao" type="file" size="50"></td>
        <td bgcolor="eeeeee" class="exibir">
          <div align="left">
            <input name="submit" type="submit" class="botao" onClick="document.form1.acao.value='Anexar'" value="Anexar">
          </div></td>
        <td bgcolor="eeeeee" class="exibir">&nbsp;</td>
      </tr>
   <!---    <tr>
        <td colspan="5">&nbsp;</td>
      </tr> --->
      <cfloop query= "qAnexos">
        <cfif FileExists(qAnexos.Ane_Caminho)>
          <tr>
            <td colspan="3" bgcolor="eeeeee" class="form"><cfoutput>#ListLast(qAnexos.Ane_Caminho,'\')#</cfoutput></td>
            <td width="348" align="center" bgcolor="eeeeee"><cfset arquivo = ListLast(qAnexos.Ane_Caminho,'\')>
                <div align="left">
                  &nbsp;
                  <input type="button" class="botao" name="Abrir" value="Abrir" onClick="window.open('abrir_pdf_act.cfm?arquivo=<cfoutput>#arquivo#</cfoutput>','_blank')" />
                </div></td>
            <td bgcolor="eeeeee"><cfoutput>
              <div align="center">
                <input name="submit" type="submit" class="botao" onClick="document.form1.acao.value='Excluir_Anexo';document.form1.anexo.value='#qAnexos.Ane_Codigo#'" value="Excluir">
              </div>
            </cfoutput></td>
          </tr>
        </cfif>
      </cfloop>
    </cfif>
	<cfif qResposta.Pos_DtPrev_Solucao EQ "" OR dateformat(qResposta.Pos_DtPrev_Solucao,"YYYYMMDD") lt dateformat(now(),"YYYYMMDD") >
	  <cfset dtprevsol = dateformat(now(),"DD/MM/YYYY")>
	<cfelse>
	  <cfset dtprevsol = dateformat(qResposta.Pos_DtPrev_Solucao,"DD/MM/YYYY")>
	</cfif>
	<input name="frmdtprevsol" type="hidden" id="frmdtprevsol" value="<cfoutput>#dtprevsol#</cfoutput>">
	<input name="frmnovoprazo" type="hidden" id="frmnovoprazo" value="N">
    <tr>
      <td colspan="5">&nbsp;</td>
    </tr>
    <tr bgcolor="eeeeee">
	 <td colspan="5" class="exibir">Data de Previs&atilde;o da Solu&ccedil;&atilde;o:&nbsp;&nbsp;
	<input name="cbData" id="cbData" type="text" class="form" onKeyPress="numericos()" onKeyDown="Mascara_Data(this)" size="14" maxlength="10" value="<cfoutput>#dtprevsol#</cfoutput>">
	</td>
   </tr>
   <tr>
 <td colspan="5" align="center"><div align="center">
   <cfoutput>
   <input name="button" type="button" class="botao" onClick="window.open('itens_inspetores_controle_respostas.cfm?ninsp=#URL.Ninsp#&unid=#URL.Unid#&ngrup=#URL.Ngrup#&nitem=#URL.Nitem#&dtfim=#url.dtfim#&dtinic=#url.dtinic#&SE=#url.SE#&cktipo=#url.cktipo#&selstatus=#selstatus#&StatusSE=#StatusSE#','_self')" value="Voltar">
      </cfoutput> &nbsp;&nbsp;&nbsp;&nbsp;
	   <cfset resp = qResposta.Pos_Situacao_Resp>
	   <cfset numdias = qResposta.diasOcor>
	  	<cfif ((resp is 1 and numdias lte 2) or (resp is 6 and numdias lte 2) or (resp is 7 and numdias lte 2)) or ((resp is 17) or (resp is 18) or (resp is 20))>
		<input name="Submit" type="submit" class="botao" value="Salvar" onClick="document.form1.acao.value='Salvar2';" disabled>
	  <cfelse>
        <input name="Submit" type="submit" class="botao" value="Salvar" onClick="document.form1.acao.value='Salvar2';">
      </div></cfif>
	  </td>

    </tr>
     <!--- </table> --->
    <input type="hidden" name="MM_UpdateRecord" value="form1">
    <input type="hidden" name="salvar_anexar" value="">
	<input name="dtdehoje" type="hidden" id="dtdehoje" value="<cfoutput>#dateformat(now(),"DD/MM/YYYY")#</cfoutput>">
	<input name="dthojeyyyymmdd" type="hidden" id="dthojeyyyymmdd" value="<cfoutput>#DateFormat(now(),'YYYYMMDD')#</cfoutput>">
	<cfset dtposicfut = CreateDate(year(now()),month(now()),day(now()))>
	<cfset dtposicfut = DateAdd( "d", 10, dtposicfut)>
	<input name="frmsitatual" type="hidden" id="frmsitatual" value="<cfoutput>#qResposta.Pos_Situacao_Resp#</cfoutput>">
	<input name="dtdezdiasfut" type="hidden" id="dtdezdiasfut" value="<cfoutput>#DateFormat(dtposicfut,'DD/MM/YYYY')#</cfoutput>">
	<input type="hidden" name="auxano" id="auxano" value="<cfoutput>#right(DateFormat(now(),'YYYY'),2)#</cfoutput>">
	<input type="hidden" name="NumSEIAtu" id="NumSEIAtu" value="<cfoutput>#trim(qResposta.Pos_SEI)#</cfoutput>">
    <cfif trim(rsSEINCI.Pos_NCISEI) eq "" and trim(qResposta.Pos_NCISEI) eq "">
		<cfset numncisei = "">
	<cfelse>
		<cfif trim(rsSEINCI.Pos_NCISEI) neq "">
			<cfset numncisei = trim(rsSEINCI.Pos_NCISEI)>
		</cfif>	
		<cfif trim(qResposta.Pos_NCISEI) neq "">
			<cfset numncisei = trim(qResposta.Pos_NCISEI)>
		</cfif>
		<cfset numncisei = left(numncisei,5) & '.' & mid(numncisei,6,6) & '/' & mid(numncisei,12,4) & '-' & right(numncisei,2)>
	 </cfif>

	<input type="hidden" name="nseincirel" id="nseincirel" value="<cfoutput>#numncisei#</cfoutput>">
	<input type="hidden" name="nseincirel" id="nseincirel" value="<cfoutput>#numncisei#</cfoutput>">
	<input type="hidden" name="dbreincInsp" id="dbreincInsp" value="<cfoutput>#db_reincInsp#</cfoutput>">
	<input type="hidden" name="dbreincGrup" id="dbreincGrup" value="<cfoutput>#db_reincGrup#</cfoutput>">
	<input type="hidden" name="dbreincItem" id="dbreincItem" value="<cfoutput>#db_reincItem#</cfoutput>">
  </form>
  <!--- Fim Área de conteúdo --->
  <!---   </tr> --->
</table>
<!---  <cfif isDefined("Form.acao") And (Form.acao neq '')>
    <script>exibe(<cfoutput>#Form.frmResp#</cfoutput>)</script>
  <cfelse>
    <script>exibe(document.form1.frmsitatual.value)</script>
  </cfif> --->
</body>
</html>

<!---  <cfcatch>
  <cfdump var="#cfcatch#">
  	<cfif isDefined("Session.E01")>
	 <cfset StructClear(Session.E01)>
	</cfif>
</cfcatch>
 </cftry>   --->

<cfif isDefined("Session.E01")>
	<cfset StructClear(Session.E01)>
</cfif>

<cfelse>
     <cfinclude template="permissao_negada.htm">
</cfif>
