<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SNCI - Análise de Deficiências de Controle</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/4.6.2/css/bootstrap.min.css"
    />
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          sans-serif;
        background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
        margin: 0;
        padding: 0;
        min-height: 100vh;
      }

      .main-container {
        padding: 20px;
        max-width: 1400px;
        margin: 0 auto;
      }

      .header-section {
        margin-bottom: 30px;
        text-align: center;
      }

      .page-title {
        font-size: 2.5rem;
        font-weight: 800;
        color: #1e293b;
        margin-bottom: 10px;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .page-subtitle {
        font-size: 1.2rem;
        color: #64748b;
        margin-bottom: 30px;
      }

      .message-section {
        width: 100%;
        margin-bottom: 30px;
      }

      .components-grid {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 30px;
        align-items: start;
      }

      .component-container {
        background: white;
        border-radius: 16px;
        padding: 0;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        overflow: hidden;
        transition: all 0.3s ease;
      }

      .component-container:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
      }

      .resumo-container {
        padding: 20px;
      }

      .desempenho-container {
        padding: 20px;
      }

      /* Iframe para carregar os componentes */
      .component-iframe {
        width: 100%;
        border: none;
        min-height: 500px;
        border-radius: 16px;
      }

      .message-iframe {
        width: 100%;
        border: none;
        min-height: 300px;
        border-radius: 16px;
      }

      /* Responsividade */
      @media (max-width: 1200px) {
        .components-grid {
          gap: 20px;
        }
      }

      @media (max-width: 992px) {
        .components-grid {
          grid-template-columns: 1fr;
          gap: 25px;
        }

        .page-title {
          font-size: 2rem;
        }
      }

      @media (max-width: 768px) {
        .main-container {
          padding: 15px;
        }

        .page-title {
          font-size: 1.8rem;
        }

        .page-subtitle {
          font-size: 1rem;
        }
      }

      @media (max-width: 480px) {
        .main-container {
          padding: 10px;
        }

        .page-title {
          font-size: 1.5rem;
        }
      }

      /* Loading states */
      .loading-overlay {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(255, 255, 255, 0.9);
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 16px;
        z-index: 1000;
      }

      .loading-spinner {
        width: 40px;
        height: 40px;
        border: 4px solid #f3f4f6;
        border-top: 4px solid #3b82f6;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      /* Estilos para quando os componentes são carregados diretamente */
      .direct-component {
        margin: 0;
        padding: 0;
      }

      .direct-component body {
        margin: 0;
        padding: 0;
      }
    </style>
  </head>
  <body>
    <div class="main-container">
      <!-- Header -->
      <div class="header-section">
        <h1 class="page-title">
          <i
            class="fas fa-chart-line"
            style="color: #3b82f6; margin-right: 15px"
          ></i>
          SNCI - Sistema de Análise
        </h1>
        <p class="page-subtitle">
          Monitoramento e Análise de Deficiências de Controle - Dashboard
          Executivo
        </p>
      </div>

      <!-- Seção da Mensagem - Largura Total -->
      <div class="message-section">
        <div class="component-container" style="position: relative">
          <div class="loading-overlay" id="messageLoading">
            <div class="loading-spinner"></div>
          </div>
          <div id="messageComponent"></div>
        </div>
      </div>



      <!-- Grid dos Outros Componentes -->
      <div class="components-grid">

         <!-- Desempenho por Assunto -->
        <div class="component-container" style="position: relative">
          <div class="loading-overlay" id="desempenhoLoading">
            <div class="loading-spinner"></div>
          </div>
          <div id="desempenhoComponent"></div>
        </div>

        <!-- Resumo Geral -->
        <div class="component-container" style="position: relative">
          <div class="loading-overlay" id="resumoLoading">
            <div class="loading-spinner"></div>
          </div>
          <div id="resumoComponent"></div>
        </div>

       
      </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/4.6.2/js/bootstrap.bundle.min.js"></script>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // Função para carregar componente
        function loadComponent(componentPath, containerId, loadingId) {
          fetch(componentPath)
            .then((response) => response.text())
            .then((html) => {
              // Extrair apenas o conteúdo do body
              const parser = new DOMParser();
              const doc = parser.parseFromString(html, "text/html");

              // Carregar estilos
              const styles = doc.head.querySelectorAll(
                'style, link[rel="stylesheet"]'
              );
              styles.forEach((style) => {
                if (style.tagName === "STYLE") {
                  document.head.appendChild(style.cloneNode(true));
                } else if (
                  style.href &&
                  !document.querySelector(`link[href="${style.href}"]`)
                ) {
                  document.head.appendChild(style.cloneNode(true));
                }
              });

              // Carregar conteúdo do body
              const bodyContent = doc.body.innerHTML;
              document.getElementById(containerId).innerHTML = bodyContent;

              // Carregar e executar scripts
              const scripts = doc.querySelectorAll("script");
              scripts.forEach((script) => {
                const newScript = document.createElement("script");
                if (script.src) {
                  newScript.src = script.src;
                } else {
                  newScript.textContent = script.textContent;
                }
                document.body.appendChild(newScript);
              });

              // Remover loading
              setTimeout(() => {
                const loadingElement = document.getElementById(loadingId);
                if (loadingElement) {
                  loadingElement.style.opacity = "0";
                  setTimeout(() => {
                    loadingElement.style.display = "none";
                  }, 300);
                }
              }, 500);
            })
            .catch((error) => {
              console.error(`Erro ao carregar ${componentPath}:`, error);
              document.getElementById(containerId).innerHTML = `
                            <div style="padding: 40px; text-align: center; color: #ef4444;">
                                <i class="fas fa-exclamation-triangle" style="font-size: 2rem; margin-bottom: 16px;"></i>
                                <h3>Erro ao carregar componente</h3>
                                <p>Não foi possível carregar o componente ${componentPath}</p>
                            </div>
                        `;
              document.getElementById(loadingId).style.display = "none";
            });
        }

        // Carregar todos os componentes
        loadComponent(
          "includes/componentes_deficiencias_controle/mensagem_card_otimizado.html",
          "messageComponent",
          "messageLoading"
        );

        setTimeout(() => {
          loadComponent(
            "includes/componentes_deficiencias_controle/resumo-geral.html",
            "resumoComponent",
            "resumoLoading"
          );
        }, 200);

        setTimeout(() => {
          loadComponent(
            "includes/componentes_deficiencias_controle/desempenho_assunto_html.html",
            "desempenhoComponent",
            "desempenhoLoading"
          );
        }, 400);

        // Efeitos visuais adicionais
        const componentContainers = document.querySelectorAll(
          ".component-container"
        );

        // Animação de entrada sequencial
        componentContainers.forEach((container, index) => {
          container.style.opacity = "0";
          container.style.transform = "translateY(30px)";

          setTimeout(() => {
            container.style.transition =
              "all 0.6s cubic-bezier(0.4, 0, 0.2, 1)";
            container.style.opacity = "1";
            container.style.transform = "translateY(0)";
          }, index * 200);
        });

        // Intersection Observer para animações na rolagem
        const observerOptions = {
          threshold: 0.1,
          rootMargin: "0px 0px -50px 0px",
        };

        const observer = new IntersectionObserver((entries) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) {
              entry.target.style.transform = "translateY(0) scale(1)";
              entry.target.style.opacity = "1";
            }
          });
        }, observerOptions);

        componentContainers.forEach((container) => {
          observer.observe(container);
        });

        // Atualização automática (opcional)
        let autoRefreshInterval;

        function startAutoRefresh() {
          autoRefreshInterval = setInterval(() => {
            // Recarregar apenas o componente de mensagem (mais dinâmico)
            loadComponent(
              "includes/componentes_deficiencias_controle/mensagem_card_otimizado.html",
              "messageComponent",
              "messageLoading"
            );
          }, 300000); // 5 minutos
        }

        // Comentar a linha abaixo se não quiser auto-refresh
        // startAutoRefresh();

        // Parar auto-refresh quando a aba não estiver visível
        document.addEventListener("visibilitychange", () => {
          if (document.hidden) {
            clearInterval(autoRefreshInterval);
          } else {
            // startAutoRefresh();
          }
        });
      });

      // Função global para forçar atualização
      window.refreshComponents = function () {
        location.reload();
      };

      // Tratamento de erro global
      window.addEventListener("error", function (e) {
        console.error("Erro global:", e.error);
      });
    </script>
  </body>
</html>
